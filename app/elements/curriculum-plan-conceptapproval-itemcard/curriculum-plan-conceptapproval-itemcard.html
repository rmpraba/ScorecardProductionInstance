
<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="curriculum-plan-conceptapproval-itemcard">
  <template>
    <style>
    .bgtable
      {   table-layout: fixed;
          width: 1920px;;
          border-collapse: collapse;
          margin-left: -2%;
          margin-top: 0%;
        }
         #save2dialog
        {
          border-radius: 10px;
          width: 354px;
          height: 170px;
        }
        #failure2dialog
        {
          border-radius: 10px;
          width: 354px;
          height: 170px;
        }
          .home
      {
         width: 92%;
        height: 50%;
        overflow-x: hidden;
        overflow-y: scroll;
      }
           .home1
      {
         width: 92%;
        height: 50%;
        overflow-x: hidden;
        overflow-y: scroll;
      }
      #Conceptassesmentdialog
      {
          border-radius: 10px;
        width: 650px;
        height: 300px;
        margin-left: -6%;
      }
      #Conceptassesmentdia1log
       {
          border-radius: 10px;
        width: 650px;
        height: 300px;
        margin-left: -6%;
      }
    </style>
   
    <table class="bgtable" border="1" style="border-collapse: collapse;">
        <tr>
              <td style="width: 2.35%;">{{sno}}</td>
              <td style="width: 8.35%;">{{conceptname}}</td>
              <td style="width: 7.55%;">{{subconceptname}}</td>
              <td style="text-align: center;width: 3.25%;">{{period}}</td>
              <td style="width: 5.5%;word-wrap: break-word;">
              {{skill}}
              </td>
              <td style="width: 5.5%;word-wrap: break-word;">
                {{assesmentdate}}
              </td>
              <td style="width: 5.5%;word-wrap: break-word;">
                {{value}}
              </td>
              <td style="word-wrap: break-word;width: 5.5%;">
                <a href="">{{teachingaid}}</a>
              </td>
              <td style="word-wrap: break-word;width: 5.5%;">{{innovation}}</td> 
              <td style="width: 5.5%;">{{fromdate}}</td>
              <td style="width: 5.5%;">
               {{todate}}
              </td>             
              <td style="word-wrap: break-word;width: 5.5%;">{{remarks}}</td>
              <td style="width: 5.5%;">
                <div hidden$="{{hidetitleflag}}">{{coremarks}}</div>
                <paper-input value={{coremark}} hidden$="{{hideflag}}"></paper-input>
              </td>
              <td style="width: 5.5%;">
               <div hidden$="{{hidetitleflag}}">{{correctionstatus}}</div>
                <paper-input value={{correctionstatus}} hidden$="{{hideflag}}"></paper-input>
              </td>
              <td style="width: 7%;">
              <!-- <td hidden$="{{hidetitleflag}}" style="width: 5.5%;"> -->
                <paper-checkbox id="chpayes{{subconceptid}}" checked on-change="FnAssesmentYes">Completed</paper-checkbox><br>
                <paper-checkbox id="chpano{{subconceptid}}" on-change="FnAssesmentNo">Not Completed</paper-checkbox>
              </td>  
              <td hidden$="{{hidetitleflag}}" style="width: 5.5%;">{{completiondate}}</td>
              <td hidden$="{{hideflag}}" style="width: 5.5%;">
              <complection-date-picker-card></complection-date-picker-card>
              </td>
              <td hidden$="{{hidetitleflag}}" style="width: 5.5%;">{{completionstatus}}</td>
              <td hidden$="{{hideflag}}" style="width: 5.5%;">
                <paper-checkbox id="cpayes{{subconceptid}}" checked on-change="FnYes">Yes</paper-checkbox><br>
                <paper-checkbox id="cpano{{subconceptid}}" on-change="FnNo">No</paper-checkbox></td>
              <td style="width: 5.5%;">
                <div hidden$="{{hidetitleflag}}">{{enrichmentsug}}</div>
                <paper-input value={{enrichmentsuggest}} hidden$="{{hideflag}}"></paper-input>
              </td>
              <td style="width: 7%;" hidden$="{{hideflag}}">
                <!-- <td hidden$="{{hidetitleflag}}" style="width: 5.5%;"> -->
                <paper-checkbox id="chphwyes{{subconceptid}}" checked on-change="FnHomeworkYes">Completed</paper-checkbox><br>
                <paper-checkbox id="chphwno{{subconceptid}}" on-change="FnHomeworkNo">Not Completed</paper-checkbox>
              <!-- <div  hidden$="{{hidetitleflag}}">{{hometype}}</div> -->
              <!-- <paper-icon-button  icon="add" on-click="fnhome" style="color:#6699ff;float: right;"></paper-icon-button> -->
              </td>              
              <td style="width: 2%;" hidden$="{{hideflag}}"><paper-icon-button icon="save" on-click="FnSave"></paper-icon-button></td>
        </tr>
      </table>
      <P hidden>hometypeid</P>
       <paper-dialog id="save2dialog" modal>
       <h3><center>UPDATED</center></h3>
       <center>
         <paper-button on-click="close2dialog" style="color:white;background-color:black;margin-top: 15%;">OK</paper-button>
       </center>
     </paper-dialog>

      <paper-dialog id="failure2dialog" modal>
       <h3><center>FAILURE</center></h3>
       <center>
         <paper-button on-click="failureclose2" style="color:white;background-color:black;margin-top: 15%;">OK</paper-button>
       </center>
     </paper-dialog>
    <paper-dialog id="Conceptassesmentdialog" modal>
     <h3>Assesment Type</h3>
         <div class="home">
            <table border="0">
              <tr>
                <th></th>
                <th>Assementname</th>
                <th>Assesmenttype</th>
                <th>Link</th>
              </tr>
             
             <template is="dom-repeat" items="{{assementarr}}" as="sa">
             <tr>
               <concept-assesment-card rowid='{{rowid}}' assesmenttype="{{sa.assesment_type}}"  id="VVYJ{{rowid}}{{sa.assesment_type_id}}" assementname='{{sa.assement_name}}' assesmenttypeid="{{sa.assesment_type_id}}" assesmenturl='{{sa.assesment_url}}' check="{{sa.check}}"></concept-assesment-card>
            </tr>
            </template>
         
           </table> 
        </div>
          <center style="margin-top: 5%;">
            <paper-button id="fnconsaveinfoid" on-click="FndialogSave" style="color:white;background-color:black">Save</paper-button>
            <paper-button id="taid1" style="color:white;background-color:black" on-click="fnclose" >Close</paper-button>
          </center>
          <p hidden>{{checkids}}</p>
    </paper-dialog>
       <paper-dialog id="Conceptassesmentdia1log" modal>
     <h3>Home Work </h3>
         <div class="home1">
            <table border="0">
              <tr>
                <th></th>
                <th>Homework name</th>
                <th>Homework Type</th>
                <th>Link</th>
              </tr>
             
             <template is="dom-repeat" items="{{homearrs}}" as="sa">
             <tr>
              <homeworknig-item-card rowid='{{rowid}}' hometypeid="{{sa.home_type_id}}"  id="VVYJ{{rowid}}{{sa.home_type_id}}" homeworkname='{{sa.homework_name}}' homeworktype="{{sa.homework_type}}" ansurl='{{sa.ans_url}}' qusurl='{{sa.qus_url}}' check="{{sa.check}}"></homeworknig-item-card>
            </tr>
            </template>
           </table> 
        </div>
          <center style="margin-top: 5%;">
            
            <paper-button id="taid1" style="color:white;background-color:black" on-click="fnclose1" >Close</paper-button>
          </center>
         
    </paper-dialog>
    <iron-ajax
        method="post"
        id="conassesmenttypeajax"
        url="{{conassesmenttypeurl}}"
        params="{{conassesmenttypeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="conassesmenttypeResponse"
        debounce-duration="300" />
     </iron-ajax>
      <iron-ajax
        method="post"
        id="homeajax"
        url="{{homeurl}}"
        params="{{homeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="homeResponse"
        debounce-duration="300" />
     </iron-ajax>
    <teacher-book-service-card id="bookservice"></teacher-book-service-card>
  </template>
  <script>
  (function() {
    'use strict';
     var completionstatus;
     var assesmentarr;
     var assmentsarr=[];
     var assesmentcheckid1=false;
     var c='';
    Polymer({
      is: 'curriculum-plan-conceptapproval-itemcard',

fnchange:function(e){
  //alert(this.checkids);
  //alert(this.checkids+" "+"true");
  if(this.checkids=="true"){
    //alert(1);
    this.$.Conceptassesmentdialog.toggle();
     this.fnassementtype();
    this.$.fnconsaveinfoid.hidden=true;
     c=this.id;
  }
  else{
   this.$.fnconsaveinfoid.hidden=false;
 //alert(2);
 if(document.querySelector('#'+this.id).checked==true){
    this.fnassementtype();
    this.$.Conceptassesmentdialog.toggle();
    assesmentcheckid1=true;
  }
else if(document.querySelector('#'+this.id).checked==false){
this.$.Conceptassesmentdialog.close();
  assesmentcheckid1=false;

}
  }




},
FndialogSave:function(e){
   this.$.Conceptassesmentdialog.close();
},
FnhomeSave:function(e){

},
assesmentvalues:function(e){
 assmentsarr=e;

},

fnassementtype:function(e){
 this.$.Conceptassesmentdialog.toggle();

 this.conassesmenttypeurl=sessionStorage.getItem("addrinfo")+"/conceptassement-service";
     var obj={};
     obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
    obj.academic_year=localStorage.getItem("curr_sess_academicyear");
     obj.capter_id=localStorage.getItem("curr_sess_capters");
     obj.subjectid=localStorage.getItem("curr_sess_subjectid");
     obj.gradeid=localStorage.getItem("curr_sess_gradeid");
     obj.sectionid=localStorage.getItem("curr_sess_sectionid");

     obj.termid=sessionStorage.getItem("termid"); 
     obj.period=this.period;
     obj.conceptid=this.conceptid;
     obj.rowid=this.rowid; 
     obj.planneddate=this.planneddate;
     this.conassesmenttypeparam=obj;
     this.$.conassesmenttypeajax.generateRequest();

},
conassesmenttypeResponse:function(e){
var arr1= e.detail.response.returnval;
var arr= e.detail.response.dbarr;
//alert(JSON.stringify(arr));
//alert(JSON.stringify(arr1));
var hworkarr=[];
   var temp=[];
      var k;
      if(arr1!=""){
         k=arr1[0].assesment_type_id;
          temp=k.split(",");
       }
for(var j=0;j<arr.length;j++)
          {
            var flag=0;
              for(var i=0;i<temp.length;i++)
              {  
                if(arr[j].assesment_type_id==temp[i])
                  { 
                   flag=1;
                   arr[j].check=true;   
                   var obj={};
                   obj.assesment_type_id=arr[j].assesment_type_id;
                   obj.assesment_type=arr[j].assesment_type;
                   obj.assement_name=arr[j].assement_name;
                   obj.assesment_url=arr[j].assesment_url;
                   obj.rowid=this.rowid;
                   obj.id="VVYJ"+this.rowid+arr[j].assesment_type_id;
                  
                    }}
              if(flag==0)
                 {
                  arr[j].check=false;
                 }}

  this.assementarr=arr;
  },
  fnhome:function(e){
this.$.Conceptassesmentdia1log.toggle();
//alert(1);

this.homeurl=sessionStorage.getItem("addrinfo")+"/home-service";
     var obj={};
     obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
     obj.academic_year=localStorage.getItem("curr_sess_academicyear");
     obj.capter_id=localStorage.getItem("curr_sess_capters");
     obj.subjectid=localStorage.getItem("curr_sess_subjectid");
     obj.gradeid=localStorage.getItem("curr_sess_gradeid");
     obj.sectionid=localStorage.getItem("curr_sess_sectionid");

     obj.termid=sessionStorage.getItem("termid"); 
     obj.period=this.period;
     obj.conceptid=this.conceptid;
     obj.rowid=this.rowid; 
     obj.planneddate=this.planneddate;
     this.homeparam=obj;
     this.$.homeajax.generateRequest();

},
homeResponse:function(e){
  var arr1= e.detail.response.returnval;
var arr= e.detail.response.dbarr;
//alert(JSON.stringify(arr));
//alert(JSON.stringify(arr1));
var hworkarr=[];
   var temp=[];
      var k;
      if(arr1!=""){
         k=arr1[0].home_type_id;
          temp=k.split(",");
       }
for(var j=0;j<arr.length;j++)
          {
            var flag=0;
              for(var i=0;i<temp.length;i++)
              {  
                if(arr[j].home_type_id==temp[i])
                  {  
                   flag=1; 
                   arr[j].check=true;   
                   var obj={};
                   obj.home_type_id=arr[j].home_type_id;
                   obj.homework_type=arr[j].homework_type;
                   obj.homework_name=arr[j].homework_name;
                   obj.ans_url=arr[j].ans_url;
                   obj.qus_url=arr[j].qus_url;
                   obj.rowid=this.rowid;
                   obj.id="VVYJ"+this.rowid+arr[j].home_type_id;
                   hworkarr.push(obj);
                    }}
              if(flag==0)
                 {
                  arr[j].check=false;
                 }}

  this.homearrs=hworkarr;
},
fnclose1:function(e){
this.$.Conceptassesmentdia1log.close();

},

fnclose:function(e){
this.$.Conceptassesmentdialog.close();

  if(this.checkids=="true"){
  document.querySelector('#'+c).checked=true;
  c='';

}
},
      FnYes:function(e){
        if(document.querySelector("#cpayes"+this.subconceptid).checked==true){
       completionstatus="Yes";
        document.querySelector("#cpano"+this.subconceptid).checked=false;
        }
        if(document.querySelector("#cpayes"+this.subconceptid).checked==false)
      completionstatus="";
      },
      FnNo:function(e){
        if(document.querySelector("#cpano"+this.subconceptid).checked==true)
        {
      completionstatus="No";
        document.querySelector("#cpayes"+this.subconceptid).checked=false;
        }
        if(document.querySelector("#cpano"+this.subconceptid).checked==false)
       completionstatus="";
      },


      FnSave:function(){
  //alert(assesmentcheckid1);

        if(completionstatus==""||completionstatus==null)
        {
       completionstatus='Yes';
        var obj={};
        obj.sno=this.sno;
        obj.rowid=this.rowid; 
        obj.conceptid=this.conceptid;
        obj.conceptname=this.conceptname;
        obj.subconceptid=this.subconceptid;
        obj.subconceptname=this.subconceptname;
        obj.period=this.period;
        obj.fromdate=this.fromdate;
        obj.todate=this.todate;
        obj.skill=this.skill;
        obj.assesmentdate=this.assesmentdate;
        obj.value=this.value;
        obj.teachingaid=this.teachingaid;
        obj.innovation=this.innovation;
         obj.assesmentcheckid=assesmentcheckid1;
        obj.remarks=this.remarks;
        obj.correctionstatus=this.correctionstatus;
        obj.enrichmentsuggest=this.enrichmentsuggest;
        obj.completionstatus=completionstatus;
        obj.coremark=this.coremark;
        obj.hometypeid=this.hometypeid;
        obj.hometype=this.hometype;
             //alert(JSON.stringify(obj));
        this.$.bookservice.updateapprovalstatusofchapterconcept(obj,assmentsarr);
      completionstatus=""; 
        }
        else
         {
       var obj={};
        obj.sno=this.sno;
        obj.rowid=this.rowid;
        obj.conceptid=this.conceptid;
        obj.conceptname=this.conceptname;
        obj.subconceptid=this.subconceptid;
        obj.subconceptname=this.subconceptname;
        obj.period=this.period;
        obj.fromdate=this.fromdate;
        obj.todate=this.todate;
        obj.skill=this.skill;
        obj.value=this.value;
        obj.innovation=this.innovation;
        obj.assesmentcheckid=this.assesmentcheckid;
        obj.remarks=this.remarks;
        obj.correctionstatus=this.correctionstatus;
        obj.enrichmentsuggest=this.enrichmentsuggest;
        obj.completionstatus=completionstatus;
        obj.assesmentdate=this.assesmentdate;
        obj.teachingaid=this.teachingaid;
        obj.coremark=this.coremark;
        obj.hometypeid=this.hometypeid;
        obj.hometype=this.hometype;
              //alert(JSON.stringify(obj));
        this.$.bookservice.updateapprovalstatusofchapterconcept(obj,assmentsarr);
        completionstatus=""; 
         }          
      },
   close2dialog:function()
     {
      this.$.save2dialog.close();
     },
    
     saopen2dialog:function()
     {
      this.$.save2dialog.toggle();
     },
     failureopen2:function()
     {
      this.$.failure2dialog.toggle();
     },
     failureclose2:function()
     {
      this.$.failure2dialog.close();
     },
      dateset:function()
     {
       alert('You are allowed to select future date only..!');
     },
    });
  })();
  </script>
</dom-module>
