
<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="curriculum-plan-conceptapproval-itemcard">
  <template>
    <style>
    .bgtable
      {   table-layout: fixed;
          width: 1920px;;
          border-collapse: collapse;
          margin-left: -2%;
          margin-top: 0%;
        }
         #save2dialog
        {
          border-radius: 10px;
          width: 354px;
          height: 170px;
        }
        #failure2dialog
        {
          border-radius: 10px;
          width: 354px;
          height: 170px;
        }
          .home
      {
         width: 92%;
        height: 50%;
        overflow-x: hidden;
        overflow-y: scroll;
      }
           .home1
      {
         width: 92%;
        height: 50%;
        overflow-x: hidden;
        overflow-y: scroll;
      }
      #Conceptassesmentdialog1
      {
          border-radius: 10px;
        width: 698px;
        height: 300px;
        margin-left: -6%;
      }
      #Conceptassesmentdia1log
       {
          border-radius: 10px;
        width: 650px;
        height: 300px;
        margin-left: -6%;
      }
      th,td{
        border-left: 1px solid #ddd;
    border-right: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
     }
    </style>
   
    <table class="bgtable"  style="border-collapse: collapse;">
        <tr>
              <td style="width: 2.35%;" hidden>{{sno}}</td>
              <td style="width: 8.35%;" hidden>{{conceptname}}</td>
              <td style="width: 7.55%;" hidden>{{subconceptname}}</td>

              <td style="width: 5.5%; text-align: center;">
                 <P style="height: 50px; overflow:hidden;">{{period}}</P>
              </td>
            
               <td style="width: 5.5%;">
                <P style="height: 50px; overflow:hidden;">
                  {{skill}}
              </P>
              </td>
              <td style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;">
                {{assesmentdate}}
                </P>
              </td>
              <td style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;">
                {{value}}
                </P>
              </td>

              <td style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;">
               <a href="">{{teachingaid}}</a>
                </P>
              </td>
              <td style="width: 5.5%;">
              <P style="height: 50px; overflow:hidden;">
              {{innovation}}
             </P>.
              </td> 
              <td style="width: 5.5%;">
              <P style="height: 50px; overflow:hidden;">
              {{fromdate}}
              </P>

             </td>     
              <td style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;">
               {{todate}}

               </P>
              </td>     
              <td style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;">
                     <paper-checkbox id='{{id}}' checked="{{assesmentcheckid}}" on-change="fnchange">Assesment</paper-checkbox>
              </P>
              </td>          

                     
            
              <td style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;">
               {{remarks}}
               </P>
               </td>
              <td style="width: 5.5%;">

               <P style="height: 50px; overflow:hidden;">
                <div hidden$="{{hidetitleflag}}">{{coremarks}}</div>
                <paper-input value={{coremark}} hidden$="{{hideflag}}"></paper-input>
                </P>
              </td>
              <td style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;">
               <div hidden$="{{hidetitleflag}}">{{correctionstatus}}</div>
                <paper-input value={{correctionstatus}} hidden$="{{hideflag}}"></paper-input>

                </P>
             </td>
              <td hidden$="{{hidetitleflag}}" style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;">{{completiondate}}
               </P>
               </td>

             
           

              <td hidden$="{{hideflag}}" style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;">
              <complection-date-picker-card></complection-date-picker-card>
              </P>
              </td>
              <td hidden$="{{hidetitleflag}}" style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;">{{completionstatus}}
               </P>
              </td>
              <td hidden$="{{hideflag}}" style="width: 5.5%;">

               <P style="height: 50px; overflow:hidden;">
                 <paper-checkbox id="cpayes{{subconceptid}}" checked on-change="FnYes">Yes</paper-checkbox><br>
                <paper-checkbox id="cpano{{subconceptid}}" on-change="FnNo">No</paper-checkbox>
                </P>
                </td>


              <td style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;">
                <div hidden$="{{hidetitleflag}}">{{enrichmentsug}}</div>
                <paper-input value={{enrichmentsuggest}} hidden$="{{hideflag}}"></paper-input>
                </P>
              </td>

              <td style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;"> 
               
              <paper-icon-button  icon="add" on-click="fnhome" style="color:#6699ff;float: right;"></paper-icon-button>
              {{hometype}}
              </P>
              </td>
              <td  hidden$="{{hidetitleflag}}" style="width: 5.5%;"></td>
              <td hidden$="{{hideflag}}" style="width: 5.5%;">
               <P style="height: 50px; overflow:hidden;">
               <paper-icon-button icon="save" on-click="FnSave"></paper-icon-button>
             </P>
               </td>
        </tr>
      </table>
  <div  hidden>{{hometypeid}}</div>

             
       <paper-dialog id="save2dialog" modal>
       <h3><center>UPDATED</center></h3>
       <center>
         <paper-button on-click="close2dialog" style="color:white;background-color:black;margin-top: 15%;">OK</paper-button>
       </center>
     </paper-dialog>

      <paper-dialog id="failure2dialog" modal>
       <h3><center>FAILURE</center></h3>
       <center>
         <paper-button on-click="failureclose2" style="color:white;background-color:black;margin-top: 15%;">OK</paper-button>
       </center>
     </paper-dialog>
   



 <paper-dialog id="Conceptassesmentdialog{{sno}}"  class="Conceptassesmentdialog1" modal>
   
    <center><h3>Assesment Type</h3></center>
       
   <table style="width:15%">
       <tr>
         <th>Upload your file here</th>
         <th> Enter Url/Content</th>
       </tr>
       <tr>
          <td>
            
        <body onload="myFunction()">  
       <form id="lpteachingaidupload11" method="post" enctype="multipart/form-data" action="/assesments" target="_blank">
     <p>
      <input type="file" name="upl11" id="assmentfile{{sno}}" onchange="fnassments()"/>
    </p>
    <p>
        <input type="submit"  value="Submit"  onclick="fnasssmit()"/>
    </p>
    </form>  
  </body>
   </td>
     <td>
        <iron-autogrow-textarea id="strengthvalue" placeholder=" Enter your Assesment here..." value="{{assmentcurrurl}}" ></iron-autogrow-textarea>
    </td>
       </tr>
   </table>  
   <!-- <paper-textarea label="Textarea label"></paper-textarea>
 -->      

   <center style="margin-top: 5%;">
        <!-- <a href="https://s3.ap-south-1.amazonaws.com/samsidhreportcard/13-4-2018lassonpantables.zip">Click</a> -->
            <!-- <paper-button  on-click="fnupload" style="color:white;background-color:black" hidden>Upload</paper-button> -->
            <paper-button id="taid1" style="color:white;background-color:black" on-click="FndialogSave" >Close</paper-button>
        </center>
   </paper-dialog>






<!-- 

   <h3>Assesment Type</h3>
         <div class="home">
            <table border="0">
              <tr>
                <th></th>
                <th>Assementname</th>
                <th>Assesmenttype</th>
                <th>Link</th>
              </tr>
             
             <template is="dom-repeat" items="{{assementarr}}" as="sa">
             <tr>
               <concept-assesment-card rowid='{{rowid}}' assesmenttype="{{sa.assesment_type}}"  id="VVYJ{{rowid}}{{sa.assesment_type_id}}" assementname='{{sa.assement_name}}' assesmenttypeid="{{sa.assesment_type_id}}" assesmenturl='{{sa.assesment_url}}' check="{{sa.check}}"></concept-assesment-card>
            </tr>
            </template>
         
           </table> 
        </div>
          <center style="margin-top: 5%;">
            <paper-button id="fnconsaveinfoid" on-click="FndialogSave" style="color:white;background-color:black">Save</paper-button>
            <paper-button id="taid1" style="color:white;background-color:black" on-click="fnclose" >Close</paper-button>
          </center>     </paper-dialog> -->
          <div hidden>{{checkids}}</div>

       <paper-dialog id="Conceptassesmentdia1log" modal>
     <h3>Home Work </h3>
         <div class="home1">
            <table border="0">
              <tr>
                <th></th>
                <th>Homework name</th>
                <th>Homework Type</th>
                <th>Link</th>
              </tr>
             
             <template is="dom-repeat" items="{{homearrs}}" as="sa">
             <tr>
              <homeworknig-item-card rowid='{{rowid}}' hometypeid="{{sa.home_type_id}}"  id="VVYJ{{rowid}}{{sa.home_type_id}}" homeworkname='{{sa.homework_name}}' homeworktype="{{sa.homework_type}}" ansurl='{{sa.ans_url}}' qusurl='{{sa.qus_url}}' check="{{sa.check}}"></homeworknig-item-card>
            </tr>
            </template>
           </table> 
        </div>
          <center style="margin-top: 5%;">
            
            <paper-button id="taid1" style="color:white;background-color:black" on-click="fnclose1" >Close</paper-button>
          </center>
         
    </paper-dialog>
    <iron-ajax
        method="post"
        id="conassesmenttypeajax"
        url="{{conassesmenttypeurl}}"
        params="{{conassesmenttypeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="conassesmenttypeResponse"
        debounce-duration="300" />
     </iron-ajax>
      <iron-ajax
        method="post"
        id="homeajax"
        url="{{homeurl}}"
        params="{{homeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="homeResponse"
        debounce-duration="300" />
     </iron-ajax>
    <teacher-book-service-card id="bookservice"></teacher-book-service-card>
  </template>
<script type="text/javascript">

var sno;


var homeglfilename;
var hometeachertempaids=[];
var mainurl="";
var homefilearrurl=[];

  var d=(new Date()).getDate()+"-"+((new Date()).getMonth()+1)+"-"+(new Date()).getFullYear();
function fnasssmit(){
  
  document.getElementById("Conceptassesmentdialog"+sno).opened=false;
   //document.getElementById("homefomeid"+rowid).value=homeglfilename;
   hometeachertempaids.push({"filenames":homeglfilename});
     homefilearrurl.push({"assurlurl":mainurl+"/"+d+homeglfilename,"filename":homeglfilename})
     var homefilenames="";
  
    var filenames="";
         for(var j=0;j<hometeachertempaids.length;j++){
             if(filenames=="")
                filenames=hometeachertempaids[j].filenames;
                else
                filenames=filenames+","+hometeachertempaids[j].filenames;
                this.filenames=filenames;
           }
     // document.getElementById("homefomeid"+rowid).value=this.filenames;
      alert(JSON.stringify(homefilearrurl));
     //   alert(JSON.stringify(teachertempaids));
       // alert(this.filenames);
    }


    


function fnassments(){

//alert(rowid);

    var x = document.getElementById("assmentfile"+sno);
   
    var txt = "";
    if ('files' in x) {
        if (x.files.length == 0) {
            txt = "Select one or more files.";
        } else {
            for (var i = 0; i < x.files.length; i++) {
                txt += "<br><strong>" + (i+1) + ". file</strong><br>";
                var file = x.files[i];
                if ('name' in file) {
                    txt += "name: " + file.name + "<br>";
                homeglfilename=file.name;
                }
                if ('size' in file) {
                    txt += "size: " + file.size + " bytes <br>";
                }
            }
        }
    } 

    else {
        if (x.value == "") {
            txt += "Select one or more files.";
        } else {
            txt += "The files property is not supported by your browser!";
            txt  += "<br>The path of the selected file: " + x.value; // If the browser does not support the files property, it will return the path of the selected file instead. 
        }
    }
    
  
    
   
}
</script>




  <script>
  (function() {
    'use strict';
     var completionstatus;
     var assesmentarr;
     var assmentsarr=[];
     var assesmentcheckid1=false;
     var c='';
    Polymer({
      is: 'curriculum-plan-conceptapproval-itemcard',






fnchange:function(e){
 mainurl="";  
    this.assprefix="AssesmentType"+"/"+sessionStorage.getItem("curr_sess_loggedschoolid")+"/"+localStorage.getItem("curr_sess_academicyear")+"/"+localStorage.getItem("curr_sess_subjectid")+"/"+localStorage.getItem("curr_sess_gradeid")+"/"+localStorage.getItem("curr_sess_sectionname")+"/"+sessionStorage.getItem("termid")+"/"+localStorage.getItem("curr_sess_chapterid")+"/"+localStorage.getItem("curr_sess_conceptid")+"/"+this.sno;
  // alert(this.assprefix);
   mainurl=this.assprefix;
    
     var obj={};
     
  this.conassesmenttypeurl=sessionStorage.getItem("addrinfo")+"/assesmenturl"; 
       obj.assprefix=this.assprefix;
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear"); 
        obj.gradeid=localStorage.getItem("curr_sess_gradeid");
        obj.gradename=localStorage.getItem("curr_sess_gradename");
        obj.subjectid=localStorage.getItem("curr_sess_subjectid");
        obj.subjectname=localStorage.getItem("curr_sess_subjectname");
        obj.chapterid=localStorage.getItem("curr_sess_chapterid");
        obj.chaptername=localStorage.getItem("curr_sess_chaptername");
        obj.conceptid=localStorage.getItem("curr_sess_conceptid");
        obj.conceptid=localStorage.getItem("curr_sess_conceptid");
        obj.termid=sessionStorage.getItem("termid");
        obj.rowid=this.sno;
        obj.currurl=this.assmentcurrurl;
       this.conassesmenttypeparam=obj;
        this.$.conassesmenttypeajax.generateRequest();









   sno=this.sno;
  /*alert(document.querySelector('#'+this.id).checked);
  alert(this.checkids);
  alert(this.checkids+" "+"true");*/
  if(this.checkids=="true"){
    //alert(1);
  document.getElementById("Conceptassesmentdialog"+this.sno).opened=true;
   // this.fnassementtype();
  //  this.$.fnconsaveinfoid.hidden=true;
     c=this.id;
  }
  else{
 //  this.$.fnconsaveinfoid.hidden=false;
 //alert(2);
 if(document.querySelector('#'+this.id).checked==true){
    //this.fnassementtype();
  document.getElementById("Conceptassesmentdialog"+this.sno).opened=true;
    
    assesmentcheckid1=true;
  }
else if(document.querySelector('#'+this.id).checked==false){
  document.getElementById("Conceptassesmentdialog"+sno).opened=false;
  assesmentcheckid1=false;

}
  }




},
FndialogSave:function(e){
  document.getElementById("Conceptassesmentdialog"+this.sno).opened=false;
  
},

assesmentvalues:function(e){
 assmentsarr=e;

},

fnassementtype:function(e){





/*
 this.$.Conceptassesmentdialog.toggle();

 this.conassesmenttypeurl=sessionStorage.getItem("addrinfo")+"/conceptassement-service";
     var obj={};
     obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
    obj.academic_year=localStorage.getItem("curr_sess_academicyear");
     obj.capter_id=localStorage.getItem("curr_sess_capters");
     obj.subjectid=localStorage.getItem("curr_sess_subjectid");
     obj.gradeid=localStorage.getItem("curr_sess_gradeid");
     obj.sectionid=localStorage.getItem("curr_sess_sectionid");

     obj.termid=sessionStorage.getItem("termid"); 
     obj.period=this.period;
     obj.conceptid=this.conceptid;
     obj.rowid=this.rowid; 
     obj.planneddate=this.planneddate;
     this.conassesmenttypeparam=obj;
     this.$.conassesmenttypeajax.generateRequest();*/

},
/*conassesmenttypeResponse:function(e){
var arr1= e.detail.response.returnval;
var arr= e.detail.response.dbarr;
//alert(JSON.stringify(arr));
//alert(JSON.stringify(arr1));
var hworkarr=[];
   var temp=[];
      var k;
      if(arr1!=""){
         k=arr1[0].assesment_type_id;
          temp=k.split(",");
       }
for(var j=0;j<arr.length;j++)
          {
            var flag=0;
              for(var i=0;i<temp.length;i++)
              {  
                if(arr[j].assesment_type_id==temp[i])
                  { 
                   flag=1;
                   arr[j].check=true;   
                   var obj={};
                   obj.assesment_type_id=arr[j].assesment_type_id;
                   obj.assesment_type=arr[j].assesment_type;
                   obj.assement_name=arr[j].assement_name;
                   obj.assesment_url=arr[j].assesment_url;
                   obj.rowid=this.rowid;
                   obj.id="VVYJ"+this.rowid+arr[j].assesment_type_id;
                  
                    }}
              if(flag==0)
                 {
                  arr[j].check=false;
                 }}

  this.assementarr=arr;
  },*/
  fnhome:function(e){
this.$.Conceptassesmentdia1log.toggle();
//alert(1);

this.homeurl=sessionStorage.getItem("addrinfo")+"/home-service";
     var obj={};
     obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
     obj.academic_year=localStorage.getItem("curr_sess_academicyear");
     obj.capter_id=localStorage.getItem("curr_sess_capters");
     obj.subjectid=localStorage.getItem("curr_sess_subjectid");
     obj.gradeid=localStorage.getItem("curr_sess_gradeid");
     obj.sectionid=localStorage.getItem("curr_sess_sectionid");

     obj.termid=sessionStorage.getItem("termid"); 
     obj.period=this.period;
     obj.conceptid=this.conceptid;
     obj.rowid=this.rowid; 
     obj.planneddate=this.planneddate;
     this.homeparam=obj;
     this.$.homeajax.generateRequest();

},
homeResponse:function(e){
  var arr1= e.detail.response.returnval;
var arr= e.detail.response.dbarr;
//alert(JSON.stringify(arr));
//alert(JSON.stringify(arr1));
var hworkarr=[];
   var temp=[];
      var k;
      if(arr1!=""){
         k=arr1[0].home_type_id;
          temp=k.split(",");
       }
for(var j=0;j<arr.length;j++)
          {
            var flag=0;
              for(var i=0;i<temp.length;i++)
              {  
                if(arr[j].home_type_id==temp[i])
                  {  
                   flag=1; 
                   arr[j].check=true;   
                   var obj={};
                   obj.home_type_id=arr[j].home_type_id;
                   obj.homework_type=arr[j].homework_type;
                   obj.homework_name=arr[j].homework_name;
                   obj.ans_url=arr[j].ans_url;
                   obj.qus_url=arr[j].qus_url;
                   obj.rowid=this.rowid;
                   obj.id="VVYJ"+this.rowid+arr[j].home_type_id;
                   hworkarr.push(obj);
                    }}
              if(flag==0)
                 {
                  arr[j].check=false;
                 }}

  this.homearrs=hworkarr;
},
fnclose1:function(e){
this.$.Conceptassesmentdia1log.close();

},

fnclose:function(e){
this.$.Conceptassesmentdialog.close();

  if(this.checkids=="true"){
  document.querySelector('#'+c).checked=true;
  c='';

}
},
      FnYes:function(e){
        if(document.querySelector("#cpayes"+this.subconceptid).checked==true){
       completionstatus="Yes";
        document.querySelector("#cpano"+this.subconceptid).checked=false;
        }
        if(document.querySelector("#cpayes"+this.subconceptid).checked==false)
      completionstatus="";
      },
      FnNo:function(e){
        if(document.querySelector("#cpano"+this.subconceptid).checked==true)
        {
      completionstatus="No";
        document.querySelector("#cpayes"+this.subconceptid).checked=false;
        }
        if(document.querySelector("#cpano"+this.subconceptid).checked==false)
       completionstatus="";
      },


      FnSave:function(){
  //alert(assesmentcheckid1);
alert(JSON.stringify(homefilearrurl));
        if(completionstatus==""||completionstatus==null)
        {
       completionstatus='Yes';
        var obj={};
        obj.sno=this.sno;
        obj.rowid=this.rowid; 
        obj.conceptid=this.conceptid;
        obj.conceptname=this.conceptname;
        obj.subconceptid=this.subconceptid;
        obj.subconceptname=this.subconceptname;
        obj.period=this.period;
        obj.fromdate=this.fromdate;
        obj.todate=this.todate;
        obj.skill=this.skill;
        obj.assesmentdate=this.assesmentdate;
        obj.value=this.value;
        obj.teachingaid=this.teachingaid;
        obj.innovation=this.innovation;
         obj.assesmentcheckid=assesmentcheckid1;
        obj.remarks=this.remarks;
        obj.correctionstatus=this.correctionstatus;
        obj.enrichmentsuggest=this.enrichmentsuggest;
        obj.completionstatus=completionstatus;
        obj.coremark=this.coremark;
        obj.hometypeid=this.hometypeid;
        obj.hometype=this.hometype;
        obj.assmentcurrurl=this.assmentcurrurl;
             //alert(JSON.stringify(obj));
        this.$.bookservice.updateapprovalstatusofchapterconcept(obj,homefilearrurl);
      completionstatus=""; 
        }
        else
         {
       var obj={};
        obj.sno=this.sno;
        obj.rowid=this.rowid;
        obj.conceptid=this.conceptid;
        obj.conceptname=this.conceptname;
        obj.subconceptid=this.subconceptid;
        obj.subconceptname=this.subconceptname;
        obj.period=this.period;
        obj.fromdate=this.fromdate;
        obj.todate=this.todate;
        obj.skill=this.skill;
        obj.value=this.value;
        obj.innovation=this.innovation;
        obj.assesmentcheckid=this.assesmentcheckid;
        obj.remarks=this.remarks;
        obj.correctionstatus=this.correctionstatus;
        obj.enrichmentsuggest=this.enrichmentsuggest;
        obj.completionstatus=completionstatus;
        obj.assesmentdate=this.assesmentdate;
        obj.teachingaid=this.teachingaid;
        obj.coremark=this.coremark;
        obj.hometypeid=this.hometypeid;
        obj.hometype=this.hometype;
        obj.assmentcurrurl=this.assmentcurrurl;
              //alert(JSON.stringify(obj));
        this.$.bookservice.updateapprovalstatusofchapterconcept(obj,homefilearrurl);
        completionstatus=""; 
        homefilearrurl=[];
         }          
      },
   close2dialog:function()
     {
      this.$.save2dialog.close();
     },
    
     saopen2dialog:function()
     {
      this.$.save2dialog.toggle();
     },
     failureopen2:function()
     {
      this.$.failure2dialog.toggle();
     },
     failureclose2:function()
     {
      this.$.failure2dialog.close();
     },
      dateset:function()
     {
       alert('You are allowed to select future date only..!');
     },
    });
  })();
  </script>
</dom-module>
