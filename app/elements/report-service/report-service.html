<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="..\..\bower_components/iron-ajax/iron-ajax.html">
<dom-module id="report-service">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
     <iron-ajax
        method="post"
        id="fetchstudnameajax"
        url="{{fetchstudnameurl}}"
        params="{{fetchstudnameparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchstudnameResponse"
        debounce-duration="300"
    > 

    <iron-ajax
        method="post"
        id="fetchtermmarkforreportajax"
        url="{{fetchtermmarkforreporturl}}"
        params="{{fetchtermmarkforreportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchtermmarkforreportResponse"
        debounce-duration="300"
    > 
    <iron-ajax
        method="post"
        id="fetchbeginnermarkforreportajax"
        url="{{fetchbeginnermarkforreporturl}}"
        params="{{fetchbeginnermarkforreportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchbeginnermarkforreportResponse"
        debounce-duration="300"
    >

     <iron-ajax
        method="post"
        id="assesmentwisereportajax"
        url="{{assesmentwisereporturl}}"
        params="{{assesmentwisereportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="assesmentwisereportResponse"
        debounce-duration="300"
    > 
    <iron-ajax
        method="post"
        id="termwisereportajax"
        url="{{termwisereporturl}}"
        params="{{termwisereportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="termwisereportResponse"
        debounce-duration="300"
    >
     <iron-ajax
        method="post"
        id="fetchbeginnermarkajax"
        url="{{fetchbeginnermarkurl}}"
        params="{{fetchbeginnermarkparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchbeginnermarkResponse"
        debounce-duration="300"
    >
    <iron-ajax
        method="post"
        id="subjectwisereportajax"
        url="{{subjectwisereporturl}}"
        params="{{subjectwisereportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="subjectwisereportResponse"
        debounce-duration="300"
    >
    <iron-ajax
        method="post"
        id="categorywisereportajax"
        url="{{categorywisereporturl}}"
        params="{{categorywisereportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="categorywisereportResponse"
        debounce-duration="300"
    >
    <iron-ajax
        method="post"
        id="fetchreportsubjectnameajax"
        url="{{fetchreportsubjectnameurl}}"
        params="{{fetchreportsubjectnameparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchreportsubjectnameResponse"
        debounce-duration="300"
    >
    <iron-ajax
        method="post"
        id="fetchconsolidatedtermwiseajax"
        url="{{fetchconsolidatedtermwiseurl}}"
        params="{{fetchconsolidatedtermwiseparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchconsolidatedtermwiseResponse"
        debounce-duration="300"
    >
    <iron-ajax
        method="post"
        id="consolidateddatanalysisreportajax"
        url="{{consolidateddatanalysisreporturl}}"
        params="{{consolidateddatanalysisreportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="consolidateddatanalysisreportResponse"
        debounce-duration="300"
    >
    <iron-ajax
        method="post"
        id="categorywisereportfordataanalysisajax"
        url="{{categorywisereportfordataanalysisurl}}"
        params="{{categorywisereportfordataanalysisparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="categorywisereportfordataanalysisResponse"
        debounce-duration="300"
    >
    <iron-ajax
        method="post"
        id="consolidatedreportajax"
        url="{{consolidatedreporturl}}"
        params="{{consolidatedreportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="consolidatedreportResponse"
        debounce-duration="300"
    >   
    <iron-ajax
        method="post"
        id="consolidatedstudentreportajax"
        url="{{consolidatedstudentreporturl}}"
        params="{{consolidatedstudentreportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="consolidatedstudentreportResponse"
        debounce-duration="300"
    > 
    <iron-ajax
        method="post"
        id="consolidatedreportajax1"
        url="{{consolidatedreporturl1}}"
        params="{{consolidatedreportparam1}}"
        handle-as="json"
        content-type="application/json"
        on-response="consolidatedreportResponse1"
        debounce-duration="300"
    > 
    <iron-ajax
        method="post"
        id="consolidatedreportajax3"
        url="{{consolidatedreporturl3}}"
        params="{{consolidatedreportparam3}}"
        handle-as="json"
        content-type="application/json"
        on-response="consolidatedreportResponse3"
        debounce-duration="300"
    > 
    
  </template>
  <script>
  (function() {
    'use strict';
    var studarr=[];
    var term=[];
    var beginner=[];
    var overall=[];
    var arr1=[];
    var studarr1=[];
    var studarr2=[];
    // var subjectarr=[];
    var assesment=[];
    var count1=0,count2=0;
    Polymer({
      is: 'report-service',
      callFetchstudentnameService:function(){
        this.fetchstudnameurl=sessionStorage.getItem("addrinfo")+"/fetchstudname-service";
        var obj={"scoolid":"","roleid":"","grade":"","section":""};
        obj.roleid=sessionStorage.getItem("curr_sess_loggedroleid");
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.grade=localStorage.getItem("curr_sess_grade");
        obj.section=localStorage.getItem("curr_sess_section");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        this.fetchstudnameparam=obj;
        this.$.fetchstudnameajax.generateRequest();
      },
      fetchstudnameResponse:function(e){
        studarr=e.detail.response.returnval;
        
        if(localStorage.getItem('curr_sess_loggedassesmenttype')=="Consolidatedreport"){
          document.querySelector('consolidated-report-card').FnSpinnerrActive(true); 
        if(localStorage.getItem("curr_sess_reporttype")=="Assesmentwise"){
          //document.querySelector('consolidated-report-card').FnHide();
          this.callassesmentwisereportService();
        } 
        else if(localStorage.getItem("curr_sess_reporttype")=="Termwise"){
           this.calltermwisereportService();
        }
        else if(localStorage.getItem("curr_sess_reporttype")=="Subjectwise"){
          //document.querySelector('consolidated-report-card').FnHide();
          this.callsubjectwisereportService();
        }
        else if(localStorage.getItem("curr_sess_reporttype")=="Categorywise"){
          //document.querySelector('consolidated-report-card').FnHide();
          this.callcategorywisereportService();
        } 
        else if(localStorage.getItem("curr_sess_reporttype")=="ConsolidatedTerm"){
          //document.querySelector('consolidated-report-card').FnHide();
          this.callconsolidatedtermwisereportService();
        }
        }
        else if(localStorage.getItem('curr_sess_loggedassesmenttype')=="Analysis") {    
        //document.querySelector('beginner-term-analysis-card').FnHide();  
        this.callfetchtermmarkforreportService(); 
        } 
        else if(localStorage.getItem('curr_sess_loggedassesmenttype')=="Consolidateddataanalysis") {document.querySelector('consolidated-assesment-report').FnSpinnerrActive(true);    
        // this.callconsolidateddatanalysisreportService();
        this.callconsolidatedstudentreport();
        }      
      },
      callconsolidatedstudentreport:function(){
        this.consolidatedstudentreporturl=sessionStorage.getItem("addrinfo")+"/consolidatedstudentreport-service";
        var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
        obj.termname=localStorage.getItem("curr_sess_termname");
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.grade=localStorage.getItem("curr_sess_grade");
        obj.gradeid=localStorage.getItem("curr_sess_gradeid");
        obj.section=localStorage.getItem("curr_sess_section");
        this.consolidatedstudentreportparam=obj;
        this.$.consolidatedstudentreportajax.generateRequest();
      },
      consolidatedstudentreportResponse:function(e){
        this.student=e.detail.response.returnval;
        this.student1=e.detail.response.old;
        if(this.student!='no rows'){
        if(localStorage.getItem("curr_sess_gradeid")=="g10")
        this.callconsolidatedreport(this.student);
        else if(localStorage.getItem("curr_sess_gradeid")=="g7"||localStorage.getItem("curr_sess_gradeid")=="g8"||localStorage.getItem("curr_sess_gradeid")=="g9")
        this.callconsolidatedreport3(this.student);
        else{
          document.querySelector('consolidated-assesment-report').FnSpinnerrActive(false);
          alert('Report not available!!');
        }
        }
        else{
          document.querySelector('consolidated-assesment-report').FnSpinnerrActive(false);
        }
      },
       callconsolidatedreport3:function(studentt){
        count1=studentt.length;
        this.consolidatedreporturl3=sessionStorage.getItem("addrinfo")+"/consolidatedreport-service3";
        var obj={"schoolid":""};
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        // obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.academicyear="2017-2018";
        obj.termname=localStorage.getItem("curr_sess_termname");        
        obj.grade=localStorage.getItem("curr_sess_grade");
        obj.gradeid=localStorage.getItem("curr_sess_gradeid");
        var grade=localStorage.getItem("curr_sess_gradeid");
        var g=grade.substring(grade.indexOf('g')+1);
        var oldgrade="g"+(parseInt(g)-1);
        obj.gradeid=oldgrade;
        for(var i=0;i<studentt.length;i++){
        obj.studentid=studentt[i].id;
        obj.studentname=studentt[i].student_name;
        this.student_name=studentt[i].student_name;
        this.consolidatedreportparam3= obj;
        this.$.consolidatedreportajax3.generateRequest();
        }
      },
      consolidatedreportResponse3:function(e){
        var assesment=e.detail.response.assesment;
        var master=e.detail.response.master;
        var subject=e.detail.response.subject;
        var grade=e.detail.response.grade;
        count2++;
        
        var temparr=[];
        for(var i=0;i<subject.length;i++){
          var obj={};
          obj.subject=subject[i].subject_id;
          obj.PT1='';
          obj.NB1='';
          obj.SEA1='';
          obj.HY='';
          obj.mark1='';
          obj.grade1='';
          obj.PT2='';
          obj.NB2='';
          obj.SEA2='';
          obj.Y='';
          obj.mark2='';
          obj.grade2='';
          temparr.push(obj);
        }
        for(var i=0;i<temparr.length;i++){
          for(var j=0;j<this.student.length;j++){
            if(this.student[j].id==e.detail.response.studentid)
            temparr[i].student_id=this.student[j].id;
            temparr[i].student_name=this.student[j].student_name;
          }
        }
        // alert(JSON.stringify(temparr));

        for(var i=0;i<assesment.length;i++){
          for(var j=0;j<master.length;j++){
            if((assesment[i].term_name).toLowerCase()==(master[j].term_name).toLowerCase()&&(assesment[i].assesment_id).toLowerCase()==(master[j].assesment_type).toLowerCase()&&assesment[i].grade==master[j].grade_name&&assesment[i].subject_id==master[j].subject_name){
              // alert('in');
              if((master[j].scale_type)=="/")
               assesment[i].score=parseFloat(parseFloat(assesment[i].total)/parseFloat(master[j].scalar)).toFixed(2);
              if((master[j].scale_type)=="*")
               assesment[i].score=parseFloat(parseFloat(assesment[i].total)*parseFloat(master[j].scalar)).toFixed(2);
              if((master[j].scale_type)=="/*")
               assesment[i].score=parseFloat((parseFloat(assesment[i].total)/parseFloat(master[j].actual_scale))*parseFloat(master[j].scalar)).toFixed(2);
            }
          }
        }
        // alert(JSON.stringify(assesment));
        for(var j=0;j<temparr.length;j++){
        for(var i=0;i<assesment.length;i++){          
          if(assesment[i].subject_id==temparr[j].subject&&assesment[i].student_id==temparr[j].student_id){
            // alert('in');
            // alert(assesment[i].subject_id+"  "+assesment[i].student_id+"  "+assesment[i].term_name+"  "+assesment[i].score);
            // alert('yes'+assesment[i].term_name);
          if((assesment[i].term_name).toLowerCase()=="term1"){
            // alert(JSON.stringify(temparr[j]));
            // alert("in1.."+assesment[i].term_name+"  "+temparr[j].subject+" "+assesment[i].assesment_id+" "+assesment[i].score);
            if(((assesment[i].assesment_id).trim()).toLowerCase()=="periodic test1"){
              // alert('in PT'+assesment[i].score);
              temparr[j].PT1=assesment[i].score;
              // alert(temparr[j].PT1);
            }
            if(((assesment[i].assesment_id).trim()).toLowerCase()=="note book"){
              temparr[j].NB1=assesment[i].score;
            }
            if(((assesment[i].assesment_id).trim()).toLowerCase()=="sea1"){
              temparr[j].SEA1=assesment[i].score;
            }
            if(((assesment[i].assesment_id).trim()).toLowerCase()=="half yearly"){
              temparr[j].HY=assesment[i].score;
            }
          }
          if((assesment[i].term_name).toLowerCase()=="term2"){
            // alert("in2.."+assesment[i].term_name+"  "+temparr[j].subject+" "+assesment[i].assesment_id+" "+assesment[i].score);
            if(((assesment[i].assesment_id).trim()).toLowerCase()=="periodic test2"){
              // alert("in PT"+assesment[i].score);
              temparr[j].PT2=assesment[i].score;
            }
            if(((assesment[i].assesment_id).trim()).toLowerCase()=="note book")
              temparr[j].NB2=assesment[i].score;
            if(((assesment[i].assesment_id).trim()).toLowerCase()=="sea2"){
              // alert("in SEA"+assesment[i].score);
              temparr[j].SEA2=assesment[i].score;
            }
            if(((assesment[i].assesment_id).trim()).toLowerCase()=="yearly")
              temparr[j].Y=assesment[i].score;
          }
          }
          // alert(JSON.stringify(temparr));
          }
          // alert(JSON.stringify(temparr[j]));
        }
        // alert(e.detail.response.studentid);
        // alert(JSON.stringify(temparr));
        for(var i=0;i<temparr.length;i++){
          if(temparr[i].PT1==""||temparr[i].PT1==null)
            temparr[i].PT1=0;
          if(temparr[i].NB1==""||temparr[i].NB1==null)
            temparr[i].NB1=0;
          if(temparr[i].SEA1==""||temparr[i].SEA1==null)
            temparr[i].SEA1=0;
          if(temparr[i].HY==""||temparr[i].HY==null)
            temparr[i].HY=0;
          temparr[i].mark1=Math.round(parseFloat(parseFloat(temparr[i].PT1)+parseFloat(temparr[i].NB1)+parseFloat(temparr[i].SEA1)+parseFloat(temparr[i].HY)).toFixed(2));
          // if((localStorage.getItem("curr_sess_termname").trim()).toLowerCase()=="term2"){
          if(temparr[i].PT2==""||temparr[i].PT2==null)
            temparr[i].PT2=0;
          if(temparr[i].NB2==""||temparr[i].NB2==null)
            temparr[i].NB2=0;
          if(temparr[i].SEA2==""||temparr[i].SEA2==null)
            temparr[i].SEA2=0;
          if(temparr[i].Y==""||temparr[i].Y==null)
            temparr[i].Y=0;
          temparr[i].mark2=Math.round(parseFloat(parseFloat(temparr[i].PT2)+parseFloat(temparr[i].NB2)+parseFloat(temparr[i].SEA2)+parseFloat(temparr[i].Y)).toFixed(2));
          // }
         }
         // alert(JSON.stringify(temparr));
         studarr1.push({"studentname":e.detail.response.studentname,"studentid":e.detail.response.studentid,"academicyear":this.academicyear,"arr":temparr});
        
        if(count1==count2){
          count1=0;count2=0;
          // alert(JSON.stringify(studarr1));
          this.callconsolidatedreport1(this.student1);
        }
       },
     
      callconsolidatedreport:function(studentt){
        count1=studentt.length;
        // count1=1;
        this.consolidatedreporturl=sessionStorage.getItem("addrinfo")+"/consolidatedreport-service";
        var obj={"schoolid":""};
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        // obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.academicyear="2017-2018";
        obj.termname=localStorage.getItem("curr_sess_termname");
        obj.gradeid=localStorage.getItem("curr_sess_gradeid");
        var grade=localStorage.getItem("curr_sess_gradeid");
        var g=grade.substring(grade.indexOf('g')+1);
        var oldgrade="g"+(parseInt(g)-1);
        obj.gradeid=oldgrade;
        for(var i=0;i<studentt.length;i++){
        obj.studentid=studentt[i].id;
        obj.studentname=studentt[i].student_name;
        this.student_id=studentt[i].id;
        this.student_name=studentt[i].student_name;
        this.academicyear=localStorage.getItem("curr_sess_academicyear");
        this.consolidatedreportparam= obj;
        this.$.consolidatedreportajax.generateRequest();
        }
      },
      consolidatedreportResponse:function(e){
        var assesment=e.detail.response.assesment;
        var master=e.detail.response.master;
        var subject=e.detail.response.subject;
        // subjectarr=subject;
        var grade=e.detail.response.grade;
        var scaleup=e.detail.response.scaleup;
        var annual=e.detail.response.annual;
        // alert(JSON.stringify(assesment));
        // alert(JSON.stringify(master));
        if(assesment.length>0){
          count2++;
        
        // alert(JSON.stringify(assesment));
        var temparr=[];
        for(var i=0;i<subject.length;i++){
          var obj={};
          obj.subject=subject[i].subject_id;
          obj.PT1='';
          obj.NB1='';
          obj.SEA1='';
          obj.mark1='';
          obj.grade1='';
          obj.PT2='';
          obj.NB2='';
          obj.SEA2='';
          obj.mark2='';
          obj.grade2='';
          obj.PT3='';
          obj.NB3='';
          obj.SEA3='';
          obj.mark3='';
          obj.grade3='';
          temparr.push(obj);
        }

        for(var i=0;i<temparr.length;i++){
        for(var j=0;j<annual.length;j++){
          if(temparr[i].subject.toLowerCase()==annual[j].subject_id.toLowerCase()){
            temparr[i].ANNUAL=annual[j].mark;
            temparr[i].student_id=annual[j].student_id;
            temparr[i].student_name=annual[j].student_name;
          }
        }
        }

        // alert(JSON.stringify(temparr));

        for(var i=0;i<assesment.length;i++){
          for(var j=0;j<master.length;j++){
            // alert(assesment[i].assesment_id+" "+master[j].assesment_type+" "+assesment[i].grade+" "+master[j].grade_name+" "+assesment[i].subject_id+" "+master[j].subject_name);
            if(assesment[i].assesment_id==master[j].assesment_type&&assesment[i].grade==master[j].grade_name&&assesment[i].subject_id==master[j].subject_name&&(assesment[i].subject_id=="English"||assesment[i].subject_id=="Mathematics"||assesment[i].subject_id=="Science"||assesment[i].subject_id=="Social Science")){
              if((master[j].scale_type)=="/")
               assesment[i].score=parseFloat(parseFloat(assesment[i].total)/parseFloat(master[j].scalar)).toFixed(2);
              if((master[j].scale_type)=="*")
               assesment[i].score=parseFloat(parseFloat(assesment[i].total)*parseFloat(master[j].scalar)).toFixed(2);
              if((master[j].scale_type)=="/*")
               assesment[i].score=parseFloat((parseFloat(assesment[i].total)/parseFloat(assesment[i].actual_scale))*parseFloat(master[j].scalar)).toFixed(2);
            }
          }
        }

        
        // alert(JSON.stringify(assesment));
        // alert(JSON.stringify(temparr));
        for(var i=0;i<assesment.length;i++){
          for(var j=0;j<temparr.length;j++){
          if(assesment[i].subject_id==temparr[j].subject&&assesment[i].student_id==temparr[j].student_id){
            
            if((assesment[i].assesment_id).trim()=="Periodic Test"){
              temparr[j].assesment="Periodic Test";
              temparr[j].actual_scale=assesment[i].actual_scale;
              temparr[j].MPT1=assesment[i].total;
              temparr[j].PT1=assesment[i].score;
            }
            if((assesment[i].assesment_id).trim()=="Note Book"){
              temparr[j].assesment="Note Book";
              temparr[j].actual_scale=assesment[i].actual_scale;
              temparr[j].MNB1=assesment[i].total;
              temparr[j].NB1=assesment[i].score;
            }
            if((assesment[i].assesment_id).trim()=="SEA"){
              temparr[j].assesment="SEA";
              temparr[j].actual_scale=assesment[i].actual_scale;
              temparr[j].MSEA1=assesment[i].total;
              temparr[j].SEA1=assesment[i].score;
            }
          
          }
          }
          // alert(JSON.stringify(temparr));
        }
        // alert(JSON.stringify(temparr));
        // alert(JSON.stringify(annual));

        
        // alert(JSON.stringify(temparr));
        for(var i=0;i<temparr.length;i++){
          if(temparr[i].PT1==""||temparr[i].PT1==null)
            temparr[i].PT1=0;
          if(temparr[i].NB1==""||temparr[i].NB1==null)
            temparr[i].NB1=0;
          if(temparr[i].SEA1==""||temparr[i].SEA1==null)
            temparr[i].SEA1=0;
          if(temparr[i].ANNUAL==""||temparr[i].ANNUAL==null)
            temparr[i].ANNUAL=0;  
          temparr[i].mark1=Math.round(parseFloat(parseFloat(temparr[i].PT1)+parseFloat(temparr[i].NB1)+parseFloat(temparr[i].SEA1)+parseFloat(temparr[i].ANNUAL)).toFixed(2));
        }
        studarr1.push({"studentname":e.detail.response.studentname,"studentid":e.detail.response.studentid,"academicyear":this.academicyear,"arr":temparr});
        // alert(JSON.stringify(studarr1.length));
        }        
        if(count1==count2){
          count1=0;count2=0
          this.callconsolidatedreport1(this.student1);
        }
      },
      callconsolidatedreport1:function(stud){
        // alert('calling...');
        this.consolidatedreporturl1=sessionStorage.getItem("addrinfo")+"/consolidatedreport-service1";
        count1=stud.length;
        var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
        obj.termname=localStorage.getItem("curr_sess_termname");
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academicyear="2017-2018";
        // obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.grade=localStorage.getItem("curr_sess_grade");
        obj.gradeid=localStorage.getItem("curr_sess_gradeid");
        obj.section=localStorage.getItem("curr_sess_section");
        var grade=localStorage.getItem("curr_sess_gradeid");
        var g=grade.substring(grade.indexOf('g')+1);
        var oldgrade="g"+(parseInt(g)-1);
        obj.gradeid=oldgrade;
        for(var i=0;i<stud.length;i++){

          obj.studid=stud[i].id;
          this.student_id=stud[i].id;
          this.academicyear='2016-2017';
        this.consolidatedreportparam1=obj;
        this.$.consolidatedreportajax1.generateRequest();
        }
      },
      consolidatedreportResponse1:function(e){
        this.finalarr=[];       
        var arr=e.detail.response.returnval;
        var subjectarr=e.detail.response.subject;
        // alert(JSON.stringify(arr));
        // alert(JSON.stringify(subjectarr));
        if(arr.length>0){
        count2++;
        for(var i=0;i<subjectarr.length;i++){
          var obj={"subject_name":"","FA1":"","FA2":"","SA1":"","tot1":"","FA3":"","FA4":"","SA2":"","tot2":"","FA":"","SA":"","grade":"","point":""};
          this.no=0;
          var flag=0;
          for(var j=0;j<arr.length;j++){
            this.no=parseInt(this.no)+1;
            this.student_name=arr[i].student_name;
            // alert(subjectarr[i].subject_name+"   "+arr[j].subject_id);
            if((subjectarr[i].subject_name).trim()==(arr[j].subject_id).trim()){
              // alert('match');
              flag=1;
              obj.subject_name=arr[j].subject_id;
              if(arr[j].category=='FA1'){                
                obj.FA1=arr[j].cat_grade;                
                this.m1=arr[j].total;
              }
              else if(arr[j].category=='FA2'){                
                obj.FA2=arr[j].cat_grade;
                this.m2=arr[j].total;
              }
              else if(arr[j].category=='SA1'){                
                obj.SA1=arr[j].cat_grade;
                this.sm1=arr[j].total;
              }
              else if(arr[j].category=='FA3'){                
                obj.FA3=arr[j].cat_grade;
                this.m3=arr[j].total;
              }
              else if(arr[j].category=='FA4'){                
                obj.FA4=arr[j].cat_grade;
                this.m4=arr[j].total;
              }              
              else if(arr[j].category=='SA2'){                
                obj.SA2=arr[j].cat_grade;
                this.sm2=arr[j].total;
              }           
              
          }
        }
          if(flag==1){
            var t1=parseFloat(((parseFloat(this.m1)+parseFloat(this.m2)+(3*parseFloat(this.sm1)))*2)/10).toFixed(1);

            var tt1=Math.round(parseFloat(((parseFloat(this.m1)+parseFloat(this.m2)+(3*parseFloat(this.sm1)))*2)).toFixed(1));
            obj.tt1=tt1;
             // alert(t1);
              if(t1>=9.1&&t1<=10)
                obj.tot1='A1';
              if(t1>=8.1&&t1<=9)
                obj.tot1='A2';
              if(t1>=7.1&&t1<=8)
                obj.tot1='B1';
              if(t1>=6.1&&t1<=7)
                obj.tot1='B2';
              if(t1>=5.1&&t1<=6)
                obj.tot1='C1';
              if(t1>=4.1&&t1<=5)
                obj.tot1='C2';
              if(t1>=3.3&&t1<=4)
                obj.tot1='D';
              if(t1>=2.1&&t1<=3.2)
                obj.tot1='E1';
              if(t1>=0&&t1<=2)
                obj.tot1='E2';

              var t2=parseFloat(((parseFloat(this.m3)+parseFloat(this.m4)+(3*parseFloat(this.sm2)))*2)/10).toFixed(1);
              var tt2=Math.round(parseFloat(((parseFloat(this.m3)+parseFloat(this.m4)+(3*parseFloat(this.sm2)))*2)).toFixed(1));
              obj.tt2=tt2;
             // alert(t1);
              if(t2>=9.1&&t2<=10)
                obj.tot2='A1';
              if(t2>=8.1&&t2<=9)
                obj.tot2='A2';
              if(t2>=7.1&&t2<=8)
                obj.tot2='B1';
              if(t2>=6.1&&t2<=7)
                obj.tot2='B2';
              if(t2>=5.1&&t2<=6)
                obj.tot2='C1';
              if(t2>=4.1&&t2<=5)
                obj.tot2='C2';
              if(t2>=3.3&&t2<=4)
                obj.tot2='D';
              if(t2>=2.1&&t2<=3.2)
                obj.tot2='E1';
              if(t2>=0&&t2<=2)
                obj.tot2='E2';

              var fatot=parseFloat((parseFloat(this.m1)+parseFloat(this.m2)+parseFloat(this.m3)+parseFloat(this.m4))/4).toFixed(1);
              // alert(fatot);
              if(fatot>=9.1&&fatot<=10)
                obj.FA='A1';
              if(fatot>=8.1&&fatot<=9)
                obj.FA='A2';
              if(fatot>=7.1&&fatot<=8)
                obj.FA='B1';
              if(fatot>=6.1&&fatot<=7)
                obj.FA='B2';
              if(fatot>=5.1&&fatot<=6)
                obj.FA='C1';
              if(fatot>=4.1&&fatot<=5)
                obj.FA='C2';
              if(fatot>=3.3&&fatot<=4)
                obj.FA='D';
              if(fatot>=2.1&&fatot<=3.2)
                obj.FA='E1';
              if(fatot>=0&&fatot<=2)
                obj.FA='E2';

              var satot=parseFloat(parseFloat(parseFloat(this.sm1)+parseFloat(this.sm2))/2).toFixed(1);
              // alert(satot);
              if(satot>=9.1&&satot<=10)
                obj.SA='A1';
              if(satot>=8.1&&satot<=9)
                obj.SA='A2';
              if(satot>=7.1&&satot<=8)
                obj.SA='B1';
              if(satot>=6.1&&satot<=7)
                obj.SA='B2';
              if(satot>=5.1&&satot<=6)
                obj.SA='C1';
              if(satot>=4.1&&satot<=5)
                obj.SA='C2';
              if(satot>=3.3&&satot<=4)
                obj.SA='D';
              if(satot>=2.1&&satot<=3.2)
                obj.SA='E1';
              if(satot>=0&&satot<=2)
                obj.SA='E2';
              var grand=parseFloat(((parseFloat(parseFloat(fatot)*2)+(3*(parseFloat(satot))))*2)/10).toFixed(1);
              // alert(grade);
              if(grand>=9.1&&grand<=10){
                obj.grade='A1';
                obj.point='10.0';
              }
              if(grand>=8.1&&grand<=9){
                obj.grade='A2';
                obj.point='9.0';
              }
              if(grand>=7.1&&grand<=8){
                obj.grade='B1';
                obj.point='8.0';
              }
              if(grand>=6.1&&grand<=7){
                obj.grade='B2';
                obj.point='7.0';
              }
              if(grand>=5.1&&grand<=6){
                obj.grade='C1';
                obj.point='6.0';
              }
              if(grand>=4.1&&grand<=5){
                obj.grade='C2';
                obj.point='5.0';
              }
              if(grand>=3.3&&grand<=4){
                obj.grade='D';
                obj.point='4.0';
              }
              if(grand>=2.1&&grand<=3.2){
                obj.grade='E1';
                obj.point='3.0';
              }
              if(grand>=0&&grand<=2){
                obj.grade='E2'; 
                obj.point='2.0';                         
              }
              this.finalarr.push(obj); 
            }
        
        }
        studarr2.push({"studentname":this.student_name,"studentid":e.detail.response.studentid,"academicyear":this.academicyear,"arr":this.finalarr});
      if(count1==count2){
        this.callfinalfun();
      }
      }

      },
      callfinalfun:function(){
        // alert(JSON.stringify(studarr1.length));
        // alert(JSON.stringify(studarr2.length));
        var report=[];        
        var title=[];
        if(localStorage.getItem("curr_sess_grade")=="Grade-10"){
        var percent=80;
        var divider=80/12;
        var grade=localStorage.getItem("curr_sess_grade");
        var g=grade.substring(grade.indexOf('-')+1);
        // alert(g);
        var oldgrade="Grade-"+(parseInt(g)-1);
        var oldgrade1="Grade-"+(parseInt(g)-2);
        var obj={};
        obj.category="2016-2017 ("+oldgrade1+")";
        obj.spancount="8";
        obj.width=8*divider;
        title.push(obj);
        obj={};
        obj.category="2017-2018 ("+oldgrade+")";
        obj.spancount="4";
        obj.width=4*divider;
        title.push(obj);        
        report.push({"sno":"","id":"","name":"","arr":title});
        // alert(JSON.stringify(report));
        title=[];
        obj={};
        obj.category="Term1";
        obj.spancount="4";
        obj.width=4*divider;
        title.push(obj);
        obj={};
        obj.category="Term2";
        obj.spancount="4";
        obj.width=4*divider;
        title.push(obj);
        obj={};
        obj.category="Annual";
        obj.spancount="4";
        obj.width=4*divider;
        title.push(obj);
        report.push({"sno":"","id":"","name":"","arr":title});
        // alert(JSON.stringify(report));
        title=[];
        obj={};
        obj.category="English";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Mathematics";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Social Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="English";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Mathematics";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Social Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="English";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Mathematics";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Social Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        report.push({"sno":"Sno","id":"Student Id","name":"Student Name","arr":title});
        
        for(var i=0;i<studarr1.length;i++){
          title=[];
          obj={};
          obj.sno=i+1;
          obj.id=studarr1[i].studentid;
          obj.name=studarr1[i].studentname;
          var f=0;
          for(var k=0;k<studarr2.length;k++){
          if(studarr1[i].studentid==studarr2[k].studentid){
            f=1;
            // obj.name=studarr2[k].studentname;
          for(var l=0;l<studarr2[k].arr.length;l++){
            var o={};
            if(studarr2[k].arr[l].subject_name=="English"||studarr2[k].arr[l].subject_name=="Mathematics"||studarr2[k].arr[l].subject_name=="Science"||studarr2[k].arr[l].subject_name=="Social Science"){
              o={};
              o.category=studarr2[k].arr[l].tt1;
              o.spancount="1";
              o.width=1*divider;
              title.push(o);
              // o={};
              // o.category=studarr2[k].arr[l].tt2;
              // o.spancount="1";
              // o.width=1*divider;
              // title.push(o);
            }
          }
          for(var l=0;l<studarr2[k].arr.length;l++){
            var o={};
            if(studarr2[k].arr[l].subject_name=="English"||studarr2[k].arr[l].subject_name=="Mathematics"||studarr2[k].arr[l].subject_name=="Science"||studarr2[k].arr[l].subject_name=="Social Science"){
              // o={};
              // o.category=studarr2[k].arr[l].tt1;
              // o.spancount="1";
              // o.width=1*divider;
              // title.push(o);
              o={};
              o.category=studarr2[k].arr[l].tt2;
              o.spancount="1";
              o.width=1*divider;
              title.push(o);
            }
          }
          }
          } 
           
          if(f==0){
            for(var x=0;x<8;x++){
              var o={};
              o.category="";
              o.spancount="1";
              o.width=1*divider;
              title.push(o);
            }
          }

          for(var j=0;j<studarr1[i].arr.length;j++){
            var o={};
            if(studarr1[i].arr[j].subject=="English"||studarr1[i].arr[j].subject=="Mathematics"||studarr1[i].arr[j].subject=="Science"||studarr1[i].arr[j].subject=="Social Science"){
              o={};
              o.category=studarr1[i].arr[j].mark1;
              o.spancount="1";
              o.width=1*divider;
              title.push(o);
            }
          }

          obj.arr=title;
          report.push(obj);
        }
      }
      else if(localStorage.getItem("curr_sess_grade")=="Grade-7"||localStorage.getItem("curr_sess_grade")=="Grade-8"||localStorage.getItem("curr_sess_grade")=="Grade-9"){
        var percent=80;
        var divider=80/16;
        var grade=localStorage.getItem("curr_sess_grade");
        var g=grade.substring(grade.indexOf('-')+1);
        // alert(g);
        var oldgrade="Grade-"+(parseInt(g)-1);
        var oldgrade1="Grade-"+(parseInt(g)-2);
        var obj={};
        obj.category="2016-2017 ("+oldgrade1+")";
        obj.spancount="8";
        obj.width=8*divider;
        title.push(obj);
        obj={};
        obj.category="2017-2018 ("+oldgrade+")";
        obj.spancount="8";
        obj.width=8*divider;
        title.push(obj);        
        report.push({"sno":"","id":"","name":"","arr":title});
        // alert(JSON.stringify(report));
        title=[];
        obj={};
        obj.category="Term1";
        obj.spancount="4";
        obj.width=4*divider;
        title.push(obj);
        obj={};
        obj.category="Term2";
        obj.spancount="4";
        obj.width=4*divider;
        title.push(obj);
        obj={};
        obj.category="Term1";
        obj.spancount="4";
        obj.width=4*divider;
        title.push(obj);
        obj={};
        obj.category="Term2";
        obj.spancount="4";
        obj.width=4*divider;
        title.push(obj);
        report.push({"sno":"","id":"","name":"","arr":title});
        // alert(JSON.stringify(report));
        title=[];
        obj={};
        obj.category="English";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Mathematics";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Social Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="English";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Mathematics";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Social Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="English";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Mathematics";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Social Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="English";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Mathematics";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        obj={};
        obj.category="Social Science";
        obj.spancount="1";
        obj.width=1*divider;
        title.push(obj);
        report.push({"sno":"Sno","id":"Student Id","name":"Student Name","arr":title});
        
        for(var i=0;i<studarr1.length;i++){
          title=[];
          obj={};
          obj.sno=i+1;
          obj.id=studarr1[i].studentid;
          obj.name=studarr1[i].studentname;
          var f=0;
          for(var k=0;k<studarr2.length;k++){
          if(studarr1[i].studentid==studarr2[k].studentid){
            f=1;
            // obj.name=studarr2[k].studentname;
          for(var l=0;l<studarr2[k].arr.length;l++){
            var o={};
            if(studarr2[k].arr[l].subject_name=="English"||studarr2[k].arr[l].subject_name=="Mathematics"||studarr2[k].arr[l].subject_name=="Science"||studarr2[k].arr[l].subject_name=="Social Science"){
              o={};
              o.category=studarr2[k].arr[l].tt1;
              o.spancount="1";
              o.width=1*divider;
              title.push(o);
              // o={};
              // o.category=studarr2[k].arr[l].tt2;
              // o.spancount="1";
              // o.width=1*divider;
              // title.push(o);
            }
          }
          for(var l=0;l<studarr2[k].arr.length;l++){
            var o={};
            if(studarr2[k].arr[l].subject_name=="English"||studarr2[k].arr[l].subject_name=="Mathematics"||studarr2[k].arr[l].subject_name=="Science"||studarr2[k].arr[l].subject_name=="Social Science"){
              // o={};
              // o.category=studarr2[k].arr[l].tt1;
              // o.spancount="1";
              // o.width=1*divider;
              // title.push(o);
              o={};
              o.category=studarr2[k].arr[l].tt2;
              o.spancount="1";
              o.width=1*divider;
              title.push(o);
            }
          }
          }
          }
           
          if(f==0){
            for(var x=0;x<8;x++){
              var o={};
              o.category="";
              o.spancount="1";
              o.width=1*divider;
              title.push(o);
            }
          }
          // alert(studarr1[i].studentid);
          for(var j=0;j<studarr1[i].arr.length;j++){
            var o={};
            if(studarr1[i].arr[j].subject=="English"||studarr1[i].arr[j].subject=="Mathematics"||studarr1[i].arr[j].subject=="Science"||studarr1[i].arr[j].subject=="Social Science"){
              o={};
              o.category=studarr1[i].arr[j].mark1;
              o.spancount="1";
              o.width=1*divider;
              title.push(o);
              // o={};
              // o.category=studarr1[i].arr[j].mark2;
              // o.spancount="1";
              // o.width=1*divider;
              // title.push(o);
            }
          }
          for(var j=0;j<studarr1[i].arr.length;j++){
            var o={};
            if(studarr1[i].arr[j].subject=="English"||studarr1[i].arr[j].subject=="Mathematics"||studarr1[i].arr[j].subject=="Science"||studarr1[i].arr[j].subject=="Social Science"){
              // o={};
              // o.category=studarr1[i].arr[j].mark1;
              // o.spancount="1";
              // o.width=1*divider;
              // title.push(o);
              o={};
              o.category=studarr1[i].arr[j].mark2;
              o.spancount="1";
              o.width=1*divider;
              title.push(o);
            }
          }

          obj.arr=title;
          report.push(obj);
        }
      }
      else{
        alert("Report not available!!");
      }
        studarr1=[];
        studarr2=[];
        studarr=[];
      document.querySelector('consolidated-assesment-report').FnSpinnerrActive(false);
      document.querySelector('consolidated-assesment-report').hidedatareport=false;
      document.querySelector('consolidated-assesment-report').reportarr=report;

      },
      callconsolidatedreportt:function(e){
        this.consolidatedreporturl=sessionStorage.getItem("addrinfo")+"/consolidatedreport-service";
        var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
        obj.termname=localStorage.getItem("curr_sess_termname");
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.grade=localStorage.getItem("curr_sess_grade");
        obj.gradeid=localStorage.getItem("curr_sess_gradeid");
        obj.section=localStorage.getItem("curr_sess_section");
        this.consolidatedreportparam=obj;
        this.$.consolidatedreportajax.generateRequest();
      },
      consolidatedreportResponsee:function(e){
        document.querySelector('consolidated-assesment-report').FnSpinnerrActive(false);
        var assesment=e.detail.response.assesment;
        var master=e.detail.response.master;
        var subject=e.detail.response.subject;
        var grade=e.detail.response.grade;
        var scaleup=e.detail.response.scaleup;
        var annual=e.detail.response.annual;
        var overallfa=e.detail.response.overallfa;
        // alert(JSON.stringify(annual));
        for(var i=0;i<assesment.length;i++){
          for(var j=0;j<master.length;j++){
            if(assesment[i].assesment_id==master[j].assesment_type&&assesment[i].grade==master[j].grade_name&&assesment[i].subject_id==master[j].subject_name){
              // alert('in');
              if((master[j].scale_type)=="/")
               assesment[i].score=parseFloat(parseFloat(assesment[i].total)/parseFloat(master[j].scalar)).toFixed(2);
              if((master[j].scale_type)=="*")
               assesment[i].score=parseFloat(parseFloat(assesment[i].total)*parseFloat(master[j].scalar)).toFixed(2);
              if((master[j].scale_type)=="/*")
               assesment[i].score=parseFloat((parseFloat(assesment[i].total)/parseFloat(assesment[i].actual_scale))*parseFloat(master[j].scalar)).toFixed(2);
            }
          }
        }

        // alert(JSON.stringify(assesment));
        var temparr=[];
        for(var i=0;i<subject.length;i++){
          var obj={};
          obj.subject=subject[i].subject_id;
          obj.PT1='';
          obj.NB1='';
          obj.SEA1='';
          obj.mark1='';
          obj.grade1='';
          obj.PT2='';
          obj.NB2='';
          obj.SEA2='';
          obj.mark2='';
          obj.grade2='';
          obj.PT3='';
          obj.NB3='';
          obj.SEA3='';
          obj.mark3='';
          obj.grade3='';
          if(subject[i].subject_id=='s1'||subject[i].subject_id=='s2'||subject[i].subject_id=='s6'||subject[i].subject_id=='s7')
          temparr.push(obj);
        }
        var studarr=[];
        for(var x=0;x<this.student.length;x++){
        for(var i=0;i<assesment.length;i++){
          if(this.student[x].student_id==assesment[i].student_id)
          {
            var o={};
            o.studentid=assesment[i].student_id;
          for(var j=0;j<temparr.length;j++){
          if(assesment[i].subject_id==temparr[j].subject){
            
            if((assesment[i].assesment_id).trim()=="Periodic Test"){
              temparr[j].MPT1=assesment[i].total;
              temparr[j].PT1=assesment[i].score;
            }
            if((assesment[i].assesment_id).trim()=="Note Book"){
              temparr[j].MNB1=assesment[i].total;
              temparr[j].NB1=assesment[i].score;
            }
            if((assesment[i].assesment_id).trim()=="SEA"){
              temparr[j].MSEA1=assesment[i].total;
              temparr[j].SEA1=assesment[i].score;
            }
          
          }
          }
          o.temp=temparr;
          studarr.push(o);
        }
        }
        }

        // alert(JSON.stringify(studarr));

        for(var i=0;i<temparr.length;i++){
        for(var j=0;j<annual.length;j++){
          if(temparr[i].subject.toLowerCase()==annual[j].subject_id.toLowerCase()){
            temparr[i].ANNUAL=annual[j].mark;
          }
        }
        }
        for(var i=0;i<temparr.length;i++){
          if(temparr[i].PT1==""||temparr[i].PT1==null)
            temparr[i].PT1=0;
          if(temparr[i].NB1==""||temparr[i].NB1==null)
            temparr[i].NB1=0;
          if(temparr[i].SEA1==""||temparr[i].SEA1==null)
            temparr[i].SEA1=0;
          if(temparr[i].ANNUAL==""||temparr[i].ANNUAL==null)
            temparr[i].ANNUAL=0;
          temparr[i].mark1=parseFloat(parseFloat(temparr[i].PT1)+parseFloat(temparr[i].NB1)+parseFloat(temparr[i].SEA1)+parseFloat(temparr[i].ANNUAL)).toFixed(2);
          for(var n=0;n<grade.length;n++){
            if(parseFloat(temparr[i].mark1)>=parseFloat(grade[n].lower_limit)&&parseFloat(temparr[i].mark1)<=parseFloat(grade[n].upper_limit))
              temparr[i].grade1=grade[n].grade;
          }
        }
      },
      callfetchsubjectnameService:function(){
        // alert('coming....');
        this.fetchreportsubjectnameurl=sessionStorage.getItem("addrinfo")+"/fetchreportsubjectname-service";
        var obj={"scoolid":"","grade":"","subject":""};
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.grade=localStorage.getItem("curr_sess_grade");
        obj.section=localStorage.getItem("curr_sess_section");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        this.fetchreportsubjectnameparam=obj;
        this.$.fetchreportsubjectnameajax.generateRequest();
      },
      fetchreportsubjectnameResponse:function(e){
        var subjectarr=e.detail.response.returnval;
        // alert(JSON.stringify(subjectarr));
        document.querySelector('consolidated-report-card').subjectarr=subjectarr;
      },
      callfetchtermmarkforreportService:function(){
        // alert('yes');
        this.fetchtermmarkforreporturl=sessionStorage.getItem("addrinfo")+"/fetchtermmarkforreport-service";
        var obj={"schoolid":"","academicyear":"","grade":"","section":"","subject":""};
        obj.termname=localStorage.getItem("curr_sess_termname");
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.grade=localStorage.getItem("curr_sess_grade");;
        obj.section=localStorage.getItem("curr_sess_section");
        obj.subject=localStorage.getItem("curr_sess_subject");
        this.fetchtermmarkforreportparam=obj;
        this.$.fetchtermmarkforreportajax.generateRequest();
      },
      fetchtermmarkforreportResponse:function(e){      
       
       arr1=e.detail.response.returnval;
       this.callfetchbeginnermarkService();
    },
    callfetchbeginnermarkService:function(){
       this.fetchbeginnermarkurl=sessionStorage.getItem("addrinfo")+"/fetchbeginnermark-service";
        var obj={"schoolid":"","academicyear":"","grade":"","section":"","subject":""};
        obj.termname=localStorage.getItem("curr_sess_termname");
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.grade=localStorage.getItem("curr_sess_grade");;
        obj.section=localStorage.getItem("curr_sess_section");
        obj.subject=localStorage.getItem("curr_sess_subject");
        this.fetchbeginnermarkparam=obj;
        this.$.fetchbeginnermarkajax.generateRequest();
    },
    fetchbeginnermarkResponse:function(e){
      var barr=e.detail.response.returnval;
      // alert(JSON.stringify(barr));
      // for(var i=0;i<barr.length;i++){
      //   for(var j=0;j<arr1.length;j++){
      //     if(barr[i].student_id==arr1[j].student_id){
      //       arr1[j].beginner_grade=barr[i].grade;
      //     }
      //   }
      // }
      // for(var x=0;x<studarr.length;x++){
      //   for(var y=0;y<arr1.length;y++)
      //   {
      //     if(studarr[x].id==arr1[y].student_id)
      //       arr1[y].student_name=studarr[x].student_name;          
      //   }
      //  }
      //  if(arr1.length>0){      
      //  for(var i=0;i<arr1.length;i++)
      //  {
      //   var markarr=[];
      //   markarr.push(i+1);
      //   markarr.push(arr1[i].student_name);
      //   markarr.push(arr1[i].beginner_grade);
      //   markarr.push(arr1[i].term_grade);
      //   for(var j=i+1;j<arr1.length;j++)
      //   {
      //      if(arr1[i].student_id==arr1[j].student_id)
      //      {
      //       markarr.push(arr1[j].term_grade);
      //       arr1.splice(j,1);
      //       j--;
      //      }
      //   }
      //  overall.push(markarr);
      //  }
      //  }

       for(var x=0;x<barr.length;x++){
        for(var y=0;y<studarr.length;y++)
        {
          if(barr[x].student_id==studarr[y].id)
            barr[x].student_name=studarr[y].student_name;          
        }
       }
       for(var i=0;i<barr.length;i++){
        barr[i].sno=i+1;
        barr[i].score=parseFloat((barr[i].score)/10).toFixed(2);
       }
       // document.querySelector("beginner-term-analysis-card").itemarr=overall;
       document.querySelector("beginner-term-analysis-card").itemarr=barr;
       arr1=[];
       overall=[];
      // alert(JSON.stringify(overall));
    },
    callassesmentwisereportService:function(){
    this.assesmentwisereporturl=sessionStorage.getItem("addrinfo")+"/assesmentwisereport-service";
        var obj={"schoolid":"","academicyear":"","grade":"","section":"","assesment":"","termname":""};
      obj.termname=localStorage.getItem("curr_sess_termname");
      obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
      obj.academicyear=localStorage.getItem("curr_sess_academicyear");
      obj.grade=localStorage.getItem("curr_sess_grade");
      obj.gradeid=localStorage.getItem("curr_sess_gradeid");
      obj.section=localStorage.getItem("curr_sess_section");
      obj.assesment=localStorage.getItem("curr_sess_assesment");
        this.assesmentwisereportparam=obj;
        this.$.assesmentwisereportajax.generateRequest();
    },
    assesmentwisereportResponse:function(e){       
        var assesscategorycnt=e.detail.response.categorycnt;
        var arr=e.detail.response.returnval;
        var temp=[];
        var obj={};
        var title=[];
        var overall=[];
        var row=[];
        var cat=[];
        var tabwidth=0;
         if(assesscategorycnt.length>0){
         // studentarr=arr;
         var categorytitle=[];
         var title=[];
         var temp=[];
         var tempcnt=0;
         var divider=0;
         var percent=0;

        for(var i=0;i<assesscategorycnt.length;i++){
          var obj={};
          obj.subject_name=assesscategorycnt[i].subject_name;
          obj.spancnt=2;
          temp.push(obj);
          tempcnt+=parseFloat(2);
        }
        //alert(JSON.stringify(temp));

        if(parseFloat(tempcnt)>=8){
          percent=80;
          tabwidth="100%";
        }
        else if(parseFloat(tempcnt)>=3){
          percent=40;
          tabwidth="60%";
        } 
        else{
          percent=25;
          tabwidth="45%";
        }
        divider=parseFloat(percent)/(parseFloat(tempcnt));
        for(var i=0;i<temp.length;i++){
            var obj={};
            obj.studentname="Student Name";
            obj.subcategoryname=temp[i].subject_name;
            obj.categorycnt=parseInt(temp[i].spancnt);
            obj.width=parseFloat(temp[i].spancnt)*parseFloat(divider)+"%";
            categorytitle.push(obj);
         }
     //   alert(JSON.stringify(categorytitle));

         overall.push({"studentname":"","tabwidth":tabwidth,"serialno":"",'category':categorytitle});
        
         temp=[];
    
     
      var  categorysubtitle=[];
        for(var i=0;i<categorytitle.length;i++){
          var obj={};
            obj.studentname="Student Name";
            obj.categorycnt=1;
            obj.width=parseFloat(categorytitle[i].width)/2+"%";
              if(i%2==0){
                  obj.subcategoryname="Grade"; 
                   }
                else{
                obj.subcategoryname="Total"; 
                 }
                categorysubtitle.push(obj);
              }
         for(var i=0;i<categorytitle.length;i++){
        var obj={};
            obj.studentname="Student Name";
            obj.categorycnt=1;
            obj.width=parseFloat(categorytitle[i].width)/2+"%";
            if(i%2==0){
              obj.subcategoryname="Grade";  
            }
             else
             obj.subcategoryname="Total"; 
              categorysubtitle.push(obj);
          }
    

  overall.push({"sno":"Sno","studentname":"Student Name","tabwidth":tabwidth,"serialno":"",'category':categorysubtitle});
  //alert(JSON.stringify(overall));
     categorytitle=[]
     categorysubtitle=[];
    for(var i=0;i<arr.length;i++){
            var obj={};
            var obj1={};

            var cnt=1;
            var category=[];
            obj.studentname=arr[i].studentname;
            obj.subcategoryname=arr[i].grade;
            obj.categorycnt=cnt;
            obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
            category.push(obj);
           
            obj1.subcategoryname=arr[i].total;
            obj1.categorycnt=cnt;
            obj1.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
            category.push(obj1);
            
             
            for(var j=i+1;j<arr.length;j++){
                obj={};
                obj1={};
             var obj2={};
             var obj3={};
             var obj4={};
             var obj5={};
            
             if(arr[i].student_id==arr[j].student_id){
              // alert(arr[j].subject_id);
                 if(arr[j].subject_id =='II Language Hindi'|| arr[j].subject_id =='II Language Kannada' || arr[j].subject_id =='II Language French'){
                  // alert(2);
                 if(arr[j].subject_id =='II Language Hindi'){
                   obj2.subcategoryname=arr[j].grade;
                   obj2.categorycnt=cnt;
                   obj2.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";

                  obj3.subcategoryname=arr[j].total;
                  obj3.categorycnt=cnt;
                  obj3.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
                   obj4.subcategoryname="";
                   obj4.categorycnt=cnt;
                   obj4.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";

                  obj5.subcategoryname="";
                  obj5.categorycnt=cnt;
                  obj5.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
                  
             arr.splice(j,1);
             j--;
             category.push(obj2);
             category.push(obj3);
             category.push(obj4);
             category.push(obj5);
            
              }
      
            else  if(arr[j].subject_id =='II Language Kannada'){
                   obj2.subcategoryname="";
                   obj2.categorycnt=cnt;
                   obj2.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
                   obj3.subcategoryname="";
                   obj3.categorycnt=cnt;
                   obj3.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
                   
                   obj4.subcategoryname=arr[j].grade;
                   obj4.categorycnt=cnt;
                   obj4.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
                   obj5.subcategoryname=arr[j].total;;
                   obj5.categorycnt=cnt;
                   obj5.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
             arr.splice(j,1);
             j--;
             category.push(obj2);
             category.push(obj3);
             category.push(obj4);
             category.push(obj5);
            
                }
                }
              else{

            obj.subcategoryname=arr[j].grade;
             obj.categorycnt=cnt;
             obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";

             obj1.subcategoryname=arr[j].total;
             obj1.categorycnt=cnt;
             obj1.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
             arr.splice(j,1);
             j--;
             category.push(obj);
             category.push(obj1);
            
                 }
                }
               }
            
            overall.push({"studentname":arr[i].studentname,"tabwidth":tabwidth,"category":category});
            
        }
    
        for(var i=2,j=0;i<overall.length;i++,j++){
            overall[i].sno=j+1;
        }  
   // alert(JSON.stringify(overall));
document.querySelector('dynamic-scholastic-markentry-report').tabwidth=tabwidth;
document.querySelector('consolidated-report-card').studarr=overall;
document.querySelector('consolidated-report-card').FnSpinnerrActive(false);
document.querySelector('consolidated-report-card').setDefaultHeaders();
        temp=[];
        overall=[];
      }
    },
    eliminateDuplicates:function(arr) {
var i;
  var len=arr.length;
  var out=[];
  var obj={};
  out.push("Sno");
  out.push("Student Name");

 for (i=0;i<len;i++) {
 obj[arr[i]]=0;
 }
 for (i in obj) {
 out.push(i);
 }
 return out;
},
 eliminateDuplicates1:function(arr) {
var i;
  var len=arr.length;
  var out=[];
  var obj={};


 for (i=0;i<len;i++) {
 obj[arr[i]]=0;
 }
 for (i in obj) {
 out.push(i);
 }
 return out;
},
    calltermwisereportService:function(){
       this.termwisereporturl=sessionStorage.getItem("addrinfo")+"/termwisereport-service";
        var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
        obj.termname=localStorage.getItem("curr_sess_termname");
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.grade=localStorage.getItem("curr_sess_grade");
        obj.gradeid=localStorage.getItem("curr_sess_gradeid");
      
        obj.section=localStorage.getItem("curr_sess_section");
        // obj.assesment=localStorage.getItem("curr_sess_assesment");
        this.termwisereportparam=obj;
        this.$.termwisereportajax.generateRequest();
    },
    termwisereportResponse:function(e){

        var assesscategory=e.detail.response.map;
        var assesscategorycnt=e.detail.response.categorycnt;
        var arr=e.detail.response.arr1;
     
        var temp=[];
        var obj={};
        var title=[];
        var overall=[];
        var row=[];
        var cat=[];
        var tabwidth=0;
         if(assesscategorycnt.length>0){
         // studentarr=arr;
         var categorytitle=[];
         var title=[];
         var temp=[];
         var tempcnt=0;
         var divider=0;
         var percent=0;

        for(var i=0;i<assesscategory.length;i++){
          var obj={};
          obj.ASSESMENT_TYPE=assesscategory[i].ASSESMENT_TYPE;
           if(i==0)
           obj.spancnt=7;
           if(i==1)
           obj.spancnt=7;
           if(i==2)
          obj.spancnt=10;
          temp.push(obj);
         
        }
        tempcnt=27;
       // alert(JSON.stringify(temp));
     if(parseFloat(tempcnt)>=8){
           percent=100;
           tabwidth="150%";
           }
         else if(parseFloat(tempcnt)>=3){
           percent=40;
           tabwidth="60%";
           } 
           else{
           percent=25;
           tabwidth="45%";
           }

        divider=parseFloat(percent)/(parseFloat(tempcnt));
        for(var i=0;i<temp.length;i++){
            var obj={};
            obj.studentname="Student Name";
            obj.subcategoryname=temp[i].ASSESMENT_TYPE;
            obj.categorycnt=parseInt(temp[i].spancnt);
             obj.width=parseFloat(temp[i].spancnt)*parseFloat(divider)+"%";
            categorytitle.push(obj);
         }
     //   alert(JSON.stringify(categorytitle));

         overall.push({"studentname":"","tabwidth":tabwidth,"serialno":"",'category':categorytitle});
        
         temp=[];
         var  categorysubtitle=[];
        for(var i=0;i<assesscategorycnt.length;i++){
          var obj={};
            obj.studentname="Student Name";
            obj.subcategoryname=assesscategorycnt[i].subject_name;
            obj.categorycnt=1;
            obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
               categorysubtitle.push(obj);
              }
         

   overall.push({"sno":"Sno","studentname":"Student Name","tabwidth":tabwidth,"serialno":"",'category':categorysubtitle});
  //alert(JSON.stringify(overall));
    categorytitle=[]
    categorysubtitle=[];

        for(var i=0;i<arr.length;i++){
            var obj={};
            

            var cnt=1;
            var category=[];
            obj.studentname=arr[i].studentname;
            obj.subcategoryname=arr[i].grade;
            obj.categorycnt=cnt;
            obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
            category.push(obj);
           
           
            for(var j=i+1;j<arr.length;j++){
                obj={};
              
             var obj2={};
             var obj3={};
             
             if(arr[i].student_id==arr[j].student_id){
              // alert(arr[j].subject_id);
                 if(arr[j].subject_id =='II Language Hindi'|| arr[j].subject_id =='II Language Kannada' || arr[j].subject_id =='II Language French'){
                  // alert(2);
                 if(arr[j].subject_id =='II Language Hindi'){
                   obj2.subcategoryname=arr[j].grade;
                   obj2.categorycnt=cnt;
                   obj2.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";

                  obj3.subcategoryname="";
                  obj3.categorycnt=cnt;
                  obj3.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
                 
                  
             arr.splice(j,1);
             j--;
             category.push(obj2);
             category.push(obj3);
            
             
                 }
              
            
           else  if(arr[j].subject_id =='II Language Kannada'){
                   obj2.subcategoryname="";
                   obj2.categorycnt=cnt;
                   obj2.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";

                   obj3.subcategoryname=arr[j].grade;
                   obj3.categorycnt=cnt;
                   obj3.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
                  
                  
             arr.splice(j,1);
             j--;
             category.push(obj2);
             category.push(obj3);
            

             
                }
                }
              else{
                  //alert(1);

             obj.subcategoryname=arr[j].grade;
             obj.categorycnt=cnt;
             obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
              arr.splice(j,1);
             j--;
             category.push(obj);
            
            
                 }
                }
               }
            
            overall.push({"studentname":arr[i].studentname,"tabwidth":tabwidth,"category":category});
            
        }
    
        for(var i=2,j=0;i<overall.length;i++,j++){
            overall[i].sno=j+1;
        }  
   
        document.querySelector('dynamic-scholastic-markentry-report').tabwidth=tabwidth;
      document.querySelector('consolidated-report-card').studarr=overall;
      document.querySelector('consolidated-report-card').FnSpinnerrActive(false);
      document.querySelector('consolidated-report-card').setDefaultHeaders();       
       
        temp=[];
        overall=[];
      }
    },

    callsubjectwisereportService:function(){
       this.subjectwisereporturl=sessionStorage.getItem("addrinfo")+"/subjectwisereport-service";
        var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
        obj.termname=localStorage.getItem("curr_sess_termname");
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.grade=localStorage.getItem("curr_sess_grade");;
        obj.section=localStorage.getItem("curr_sess_section");
        obj.assesment=localStorage.getItem("curr_sess_assesment");
        obj.subject=localStorage.getItem("curr_sess_subject");
        this.subjectwisereportparam=obj;
        this.$.subjectwisereportajax.generateRequest();
    },
    subjectwisereportResponse:function(e){
 
        var assesscategorycnt=e.detail.response.categorycnt;
        var arr=e.detail.response.returnval;
     
        var temp=[];
        var obj={};
        var title=[];
        var overall=[];
        var row=[];
        var cat=[];
        var tabwidth=0;
         if(assesscategorycnt.length>0){
         // studentarr=arr;
         var categorytitle=[];
         var title=[];
         var temp=[];
         var tempcnt=0;
         var divider=0;
         var percent=0;

        for(var i=0;i<assesscategorycnt.length;i++){
          var obj={};
          obj.assesment_type=assesscategorycnt[i].assesment_type;
          obj.spancnt=2;
          temp.push(obj);
          tempcnt+=parseFloat(2);
        }
        //alert(JSON.stringify(temp));

        if(parseFloat(tempcnt)>=8){
          percent=80;
          tabwidth="100%";
        }
        else if(parseFloat(tempcnt)>=3){
          percent=40;
          tabwidth="60%";
        } 
        else{
          percent=25;
          tabwidth="45%";
        }
        divider=parseFloat(percent)/(parseFloat(tempcnt));
        for(var i=0;i<temp.length;i++){
            var obj={};
            obj.studentname="Student Name";
            obj.subcategoryname=temp[i].assesment_type;
            obj.categorycnt=parseInt(temp[i].spancnt);
            obj.width=parseFloat(temp[i].spancnt)*parseFloat(divider)+"%";
            categorytitle.push(obj);
         }
     //   alert(JSON.stringify(categorytitle));

         overall.push({"studentname":"","tabwidth":tabwidth,"serialno":"",'category':categorytitle});
        
         temp=[];
    
     
      var  categorysubtitle=[];
        for(var i=0;i<categorytitle.length;i++){
          var obj={};
            obj.studentname="Student Name";
            obj.categorycnt=1;
            obj.width=parseFloat(categorytitle[i].width)/2+"%";
              if(i%2==0){
                  obj.subcategoryname="Grade"; 
                   }
                else{
                obj.subcategoryname="Total"; 
                 }
                categorysubtitle.push(obj);
              }
         for(var i=0;i<categorytitle.length;i++){
        var obj={};
            obj.studentname="Student Name";
            obj.categorycnt=1;
            obj.width=parseFloat(categorytitle[i].width)/2+"%";
            if(i%2==0){
              obj.subcategoryname="Grade";  
            }
             else
             obj.subcategoryname="Total"; 
              categorysubtitle.push(obj);
          }
    

  overall.push({"sno":"Sno","studentname":"Student Name","tabwidth":tabwidth,"serialno":"",'category':categorysubtitle});
  //alert(JSON.stringify(overall));
    categorytitle=[]
   categorysubtitle=[];

        for(var i=0;i<arr.length;i++){
            var obj={};
            var obj1={};

            var cnt=1;
            var category=[];
            obj.studentname=arr[i].studentname;
            obj.subcategoryname=arr[i].grade;
            obj.categorycnt=cnt;
            obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
            category.push(obj);
           
            obj1.subcategoryname=arr[i].total;
            obj1.categorycnt=cnt;
            obj1.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
            category.push(obj1);
          
             
            for(var j=i+1;j<arr.length;j++){
            obj={};
            obj1={};
            if(arr[i].student_id==arr[j].student_id){
             obj.subcategoryname=arr[j].grade;
             obj.categorycnt=cnt;
             obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
             obj1.subcategoryname=arr[j].total;
             obj1.categorycnt=cnt;
             obj1.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
            arr.splice(j,1);
            j--;
            category.push(obj);
            category.push(obj1);
             }
            }
            
            overall.push({"studentname":arr[i].studentname,"tabwidth":tabwidth,"category":category});
            
        }
    
        for(var i=2,j=0;i<overall.length;i++,j++){
            overall[i].sno=j+1;
        }  
   
  document.querySelector('dynamic-scholastic-markentry-report').tabwidth=tabwidth;

         document.querySelector('consolidated-report-card').studarr=overall;
       document.querySelector('consolidated-report-card').FnSpinnerrActive(false);
       document.querySelector('consolidated-report-card').setDefaultHeaders();
       
        temp=[];
        overall=[];
      }

  },
    callcategorywisereportService:function(){
       this.categorywisereporturl=sessionStorage.getItem("addrinfo")+"/categorywisereport-service";
        var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
        obj.termname=localStorage.getItem("curr_sess_termname");
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.grade=localStorage.getItem("curr_sess_grade");;
        obj.section=localStorage.getItem("curr_sess_section");
        obj.assesment=localStorage.getItem("curr_sess_assesment");
        // alert(JSON.stringify(localStorage.getItem("curr_sess_assesment")));
        obj.subject=localStorage.getItem("curr_sess_subject");
        this.categorywisereportparam=obj;
        this.$.categorywisereportajax.generateRequest();
    },
    categorywisereportResponse:function(e){
        var assesscategory=e.detail.response.map;
        var assesscategorycnt=e.detail.response.categorycnt;
        var arr=e.detail.response.returnval;
     
        var temp=[];
        var obj={};
        var title=[];
        var overall=[];
        var row=[];
        var cat=[];
        var tabwidth=0;
         if(assesscategory.length>0){
         // studentarr=arr;
         var categorytitle=[];
         var title=[];
         var temp=[];
         var tempcnt=0;
         var divider=0;
         var percent=0;

        for(var i=0;i<assesscategorycnt.length;i++){
          var obj={};
          obj.category_id=assesscategorycnt[i].category_id;
          obj.category_name=assesscategorycnt[i].category_name;
          obj.spancnt=assesscategorycnt[i].cnt;
          temp.push(obj);
          tempcnt+=parseFloat(assesscategorycnt[i].cnt);
        }
        //alert(JSON.stringify(temp));

        if(parseFloat(tempcnt)>=8){
          percent=80;
          tabwidth="100%";
        }
        else if(parseFloat(tempcnt)>=3){
          percent=40;
          tabwidth="60%";
        } 
        else{
          percent=25;
          tabwidth="45%";
        }
        divider=parseFloat(percent)/(parseFloat(tempcnt));
        for(var i=0;i<temp.length;i++){
            var obj={};
            obj.studentname="Student Name";
            obj.subcategoryname=temp[i].category_name;
            obj.categorycnt=parseInt(temp[i].spancnt)*2;
            obj.width=parseFloat(temp[i].spancnt)*parseFloat(divider)+"%";
            categorytitle.push(obj);
         }
     //   alert(JSON.stringify(categorytitle));

         overall.push({"studentname":"","tabwidth":tabwidth,"serialno":"",'category':categorytitle});
         categorytitle=[]
         temp=[];
        for(var i=0;i<assesscategory.length;i++){
          var obj={};
          obj.sub_category_id=assesscategory[i].sub_category_id;
          obj.sub_category_name=assesscategory[i].sub_category_name;
          obj.weight=assesscategory[i].weight;
          temp.push(obj);
        }  
     //   alert(JSON.stringify(temp));

         for(var i=0;i<temp.length;i++){
            var cnt=1;
            var obj={};
            obj.studentname="Student Name";
            obj.subcategoryname=temp[i].sub_category_name+" ("+temp[i].weight+")";
            for(var j=i+1;j<temp.length;j++){
              if(temp[i].sub_category_name==temp[j].sub_category_name&&temp[i].sub_category_id==temp[j].sub_category_id){
                cnt++;
                temp.splice(j,1);
                j--;
              }
            }
            obj.categorycnt=parseInt(cnt)*2;
            obj.width=parseFloat(cnt)*parseFloat(divider)+"%";
            categorytitle.push(obj);
         }
         overall.push({"sno":"","studentname":"","tabwidth":tabwidth,"serialno":"",'category':categorytitle});
       // alert(JSON.stringify(overall));

     
      var  categorysubtitle=[];
        for(var i=0;i<categorytitle.length;i++){
          var obj={};
            obj.studentname="Student Name";
            obj.categorycnt=1;
            obj.width=parseFloat(categorytitle[i].width)/2+"%";
              if(i%2==0){
                  obj.subcategoryname="Grade"; 
                   }
                else{
                obj.subcategoryname="Total"; 
                 }
              categorysubtitle.push(obj);
    

         }
         for(var i=0;i<categorytitle.length;i++){
        var obj={};
            obj.studentname="Student Name";
            obj.categorycnt=1;
            obj.width=parseFloat(categorytitle[i].width)/2+"%";
            if(i%2==0){
              obj.subcategoryname="Grade";  
            }
                
                else
             obj.subcategoryname="Total"; 
              categorysubtitle.push(obj);
        }

      //  alert(JSON.stringify(categorysubtitle));

  overall.push({"sno":"Sno","studentname":"Student Name","tabwidth":tabwidth,"serialno":"",'category':categorysubtitle});
  //alert(JSON.stringify(overall));

   categorysubtitle=[];

        for(var i=0;i<arr.length;i++){
            var obj={};
            var obj1={};

            var cnt=1;
            var category=[];
            obj.studentname=arr[i].student_name;
            obj.subcategoryname=arr[i].grade;
            obj.categorycnt=cnt;
            obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
            category.push(obj);
           
            obj1.subcategoryname=arr[i].total;
            obj1.categorycnt=cnt;
            obj1.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
            category.push(obj1);
          
             
            for(var j=i+1;j<arr.length;j++){
            obj={};
            obj1={};
            if(arr[i].student_id==arr[j].student_id){
             obj.subcategoryname=arr[j].grade;
             obj.categorycnt=cnt;
             obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
             obj1.subcategoryname=arr[j].total;
             obj1.categorycnt=cnt;
             obj1.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
            arr.splice(j,1);
            j--;
            category.push(obj);
            category.push(obj1);
              }
            }
overall.push({"studentname":arr[i].student_name,"tabwidth":tabwidth,"category":category});
            
        }
    
        for(var i=2,j=0;i<overall.length;i++,j++){
            overall[i].sno=j+1;
        }  
   
        document.querySelector('dynamic-scholastic-markentry-report').tabwidth=tabwidth;

         document.querySelector('consolidated-report-card').studarr=overall;
         document.querySelector('consolidated-report-card').FnSpinnerrActive(false);
         document.querySelector('consolidated-report-card').setDefaultHeaders();
       
       
        temp=[];
        overall=[];
      }
    },
    callconsolidatedtermwisereportService:function(){
        this.fetchconsolidatedtermwiseurl=sessionStorage.getItem("addrinfo")+"/fetchconsolidatedtermwise-service";
        var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
        obj.termname=localStorage.getItem("curr_sess_termname");
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.grade=localStorage.getItem("curr_sess_grade");
        obj.gradeid=localStorage.getItem("curr_sess_gradeid");;
        ;
        obj.section=localStorage.getItem("curr_sess_section");
        this.fetchconsolidatedtermwiseparam=obj;
        this.$.fetchconsolidatedtermwiseajax.generateRequest();
    },
    fetchconsolidatedtermwiseResponse:function(e){

        var assesscategory=e.detail.response.map;
        var assesscategorycnt=e.detail.response.categorycnt;
        var arr=e.detail.response.arr1;
     //alert(1);
        var temp=[];
        var obj={};
        var title=[];
        var overall=[];
        var row=[];
        var cat=[];
        var tabwidth=0;
         if(assesscategorycnt.length>0){
         // studentarr=arr;
         var categorytitle=[];
         var title=[];
         var temp=[];
         var tempcnt=0;
         var divider=0;
         var percent=0;
       
        for(var i=0;i<assesscategory.length;i++){
          var obj={};
          obj.ASSESMENT_TYPE=assesscategory[i].ASSESMENT_TYPE;
           if(i==0)
           obj.spancnt=7;
           if(i==1)
           obj.spancnt=7;
           if(i==2)
          obj.spancnt=10;
          temp.push(obj);
         }

        for(var i=0;i<assesscategory.length;i++){
          var obj={};
          obj.ASSESMENT_TYPE=assesscategory[i].ASSESMENT_TYPE;
           if(i==0)
           obj.spancnt=7;
           if(i==1)
           obj.spancnt=7;
           if(i==2)
          obj.spancnt=10;
          temp.push(obj);
         
         
        }
        for(var i=0;i<assesscategory.length;i++){
          var obj={};
          obj.ASSESMENT_TYPE=assesscategory[i].ASSESMENT_TYPE;
           if(i==0)
           obj.spancnt=7;
           if(i==1)
           obj.spancnt=7;
           if(i==2)
          obj.spancnt=10;
          temp.push(obj);
         
         
        }
      
        tempcnt=24;
   //     alert(JSON.stringify(temp));
        if(parseFloat(tempcnt)>=8){
           percent=100;
           tabwidth="150%";
           }
         else if(parseFloat(tempcnt)>=3){
           percent=40;
           tabwidth="60%";
           } 
           else{
           percent=25;
           tabwidth="45%";
           }

        divider=parseFloat(percent)/(parseFloat(tempcnt));
         var termarr=[];
           var obj={};
            obj.studentname="Student Name";
            obj.subcategoryname="Term1";
            obj.categorycnt=24;
            obj.width=(parseFloat(24)*parseFloat(divider))+"%";
            termarr.push(obj);
             obj={};
            obj.studentname="Student Name";
            obj.subcategoryname="Term2";
            obj.categorycnt=24;
            obj.width=(parseFloat(24)*parseFloat(divider))+"%";
            termarr.push(obj);
            obj={};
            obj.studentname="Student Name";
            obj.subcategoryname="Term3"; 
            obj.categorycnt=24;
            obj.width=(parseFloat(24)*parseFloat(divider))+"%";
            termarr.push(obj);
                         

       overall.push({"studentname":"","tabwidth":tabwidth,"serialno":"",'category':termarr});
        termarr=[];

        for(var i=0;i<temp.length;i++){
            var obj={};
            obj.studentname="Student Name";
            obj.subcategoryname=temp[i].ASSESMENT_TYPE;
            obj.categorycnt=(parseInt(temp[i].spancnt));
            obj.width=parseFloat(temp[i].spancnt)*parseFloat(divider)+"%";
            categorytitle.push(obj);
         }
     //   alert(JSON.stringify(categorytitle));

         overall.push({"studentname":"","tabwidth":tabwidth,"serialno":"",'category':categorytitle});
        
         temp=[];
         var  categorysubtitle=[];
        for(var i=0;i<assesscategorycnt.length;i++){
          var obj={};
            obj.studentname="Student Name";
            obj.subcategoryname=assesscategorycnt[i].subject_name;
            obj.categorycnt=1;
            obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
               categorysubtitle.push(obj);

              }
              for(var i=0;i<assesscategorycnt.length;i++){
          var obj={};
            obj.studentname="Student Name";
            obj.subcategoryname=assesscategorycnt[i].subject_name;
            obj.categorycnt=1;
            obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
               categorysubtitle.push(obj);
               
              }
         
         for(var i=0;i<assesscategorycnt.length;i++){
          var obj={};
            obj.studentname="Student Name";
            obj.subcategoryname=assesscategorycnt[i].subject_name;
            obj.categorycnt=1;
            obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
               categorysubtitle.push(obj);
               
              }
         
         

   overall.push({"sno":"Sno","studentname":"Student Name","tabwidth":tabwidth,"serialno":"",'category':categorysubtitle});
  //alert(JSON.stringify(overall));
    categorytitle=[]
    categorysubtitle=[];

        for(var i=0;i<arr.length;i++){
            var obj={};
            

            var cnt=1;
            var category=[];
            obj.studentname=arr[i].studentname;
            obj.subcategoryname=arr[i].grade;
            obj.categorycnt=cnt;
            obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
            category.push(obj);
           
           
            for(var j=i+1;j<arr.length;j++){
                obj={};
              
             var obj2={};
             var obj3={};
            
             if(arr[i].student_id==arr[j].student_id){
              // alert(arr[j].subject_id);
                 if(arr[j].subject_id =='II Language Hindi'|| arr[j].subject_id =='II Language Kannada'){
                  // alert(2);
                 if(arr[j].subject_id =='II Language Hindi'){
                   obj2.subcategoryname=arr[j].grade;
                   obj2.categorycnt=cnt;
                   obj2.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";

                  obj3.subcategoryname="";
                  obj3.categorycnt=cnt;
                  obj3.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
                  
                  
             arr.splice(j,1);
             j--;
             category.push(obj2);
             category.push(obj3);
             }
    else  if(arr[j].subject_id =='II Language Kannada'){
                   obj2.subcategoryname="";
                   obj2.categorycnt=cnt;
                   obj2.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";

                   obj3.subcategoryname=arr[j].grade;
                   obj3.categorycnt=cnt;
                   obj3.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
                   
                  
             arr.splice(j,1);
             j--;
             category.push(obj2);
             category.push(obj3);
            
                }
                }
              else{
                  //alert(1);

             obj.subcategoryname=arr[j].grade;
             obj.categorycnt=cnt;
             obj.width=(parseFloat(cnt)*parseFloat(divider))/2+"%";
              arr.splice(j,1);
             j--;
             category.push(obj);
            
            
                 }
                }
               }
            
            overall.push({"studentname":arr[i].studentname,"tabwidth":tabwidth,"category":category});
            
        }
     //alert(JSON.stringify(overall));
        for(var i=2,j=0;i<overall.length;i++,j++){
            overall[i].sno=j+1;
        }  
   //alert(2);

    document.querySelector('consolidated-report-card').studarr=overall;
     document.querySelector('consolidated-report-card').FnSpinnerrActive(false);
         document.querySelector('consolidated-report-card').setDefaultHeaders();
     
        temp=[];
        overall=[];
      }
 },
    callconsolidateddatanalysisreportService:function(){
      this.consolidateddatanalysisreporturl=sessionStorage.getItem("addrinfo")+"/consolidateddatanalysisreport-service";
var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};

        obj.termname=localStorage.getItem("curr_sess_termname");
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.grade=localStorage.getItem("curr_sess_grade");
        obj.gradeid=localStorage.getItem("curr_sess_gradeid");
        ;
        obj.section=localStorage.getItem("curr_sess_section");
        this.consolidateddatanalysisreportparam=obj;
        this.$.consolidateddatanalysisreportajax.generateRequest();
    },
    consolidateddatanalysisreportResponse:function(e){
     

        var assesscategorycnt=e.detail.response.categorycnt;
        var arr=e.detail.response.returnval;
        var temp=[];
        var obj={};
        var title=[];
        var overall=[];
        var row=[];
        var cat=[];
        var tabwidth=0;
         if(assesscategorycnt.length>0){
         // studentarr=arr;
         var categorytitle=[];
         var title=[];
         var temp=[];
         var tempcnt=0;
         var divider=0;
         var percent=0;

        for(var i=0;i<assesscategorycnt.length;i++){
          var obj={};
          obj.subject_name=assesscategorycnt[i].subject_name;
          obj.spancnt=1;
          temp.push(obj);
          tempcnt+=parseFloat(1);
        }
        //alert(JSON.stringify(temp));

        if(parseFloat(tempcnt)>=8){
          percent=80;
          tabwidth="100%";
        }
        else if(parseFloat(tempcnt)>=3){
          percent=40;
          tabwidth="60%";
        } 
        else{
          percent=25;
          tabwidth="45%";
        }
        divider=parseFloat(percent)/(parseFloat(tempcnt));
        for(var i=0;i<temp.length;i++){
            var obj={};
            obj.studentname="Student Name";
            obj.subcategoryname=temp[i].subject_name;
            obj.categorycnt=parseInt(temp[i].spancnt);
            obj.width=parseFloat(temp[i].spancnt)*parseFloat(divider)+"%";
            categorytitle.push(obj);
         }
     //   alert(JSON.stringify(categorytitle));

         overall.push({"studentname":"","tabwidth":tabwidth,"serialno":"",'category':categorytitle});
        
        for(var i=0;i<arr.length;i++){
            var obj={};
           

            var cnt=1;
            var category=[];
            obj.studentname=arr[i].studentname;
            obj.subcategoryname=arr[i].total;
            obj.subject_id=arr[i].subject_id;
            obj.categorycnt=cnt;
           obj.width=(parseFloat(cnt)*parseFloat(divider))+"%";
            category.push(obj);
             for(var j=i+1;j<arr.length;j++){
               obj={};
             var obj3={};
             var obj4={};
               
             if(arr[i].student_id==arr[j].student_id){
              // alert(arr[j].subject_id);
                 if(arr[j].subject_id =='II Language Hindi'|| arr[j].subject_id =='II Language Kannada' || arr[j].subject_id =='II Language French'){
                  // alert(2);
                 if(arr[j].subject_id =='II Language Hindi'){
                  

                    obj3.subcategoryname=arr[j].total;
                  obj3.categorycnt=cnt;
                  obj3.width=(parseFloat(cnt)*parseFloat(divider))+"%";
                    obj3.subject_id=arr[j].subject_id;


                   obj4.subject_id="";
                   obj4.subcategoryname="";

                   obj4.categorycnt=cnt;
                   obj4.width=(parseFloat(cnt)*parseFloat(divider))+"%";

                 
                  
             arr.splice(j,1);
             j--;
             category.push(obj3);
             category.push(obj4);
           
                 }
             
           else  if(arr[j].subject_id =='II Language Kannada'){
                   obj3.subject_id="";
                   obj3.subcategoryname="";

                   obj3.categorycnt=cnt;
                   obj3.width=(parseFloat(cnt)*parseFloat(divider))+"%";

                   obj4.subject_id=arr[j].subject_id;
                   obj4.subcategoryname=arr[j].total;
                   obj4.categorycnt=cnt;
                   obj4.width=(parseFloat(cnt)*parseFloat(divider))+"%";

                  
                   
             arr.splice(j,1);
             j--;
             category.push(obj3);
             category.push(obj4);
             
            
                }
                }
              else{
                  //alert(1);

             obj.subject_id=arr[j].subject_id;
             obj.subcategoryname=arr[j].total;
             obj.categorycnt=cnt;
             obj.width=(parseFloat(cnt)*parseFloat(divider))+"%";

            
             arr.splice(j,1);
             j--;
             category.push(obj);
         
            
                 }
                }
               }
            overall.push({"studentname":arr[i].studentname,"tabwidth":tabwidth,"category":category});
            
        }
    
        for(var i=2,j=0;i<overall.length;i++,j++){
            overall[i].sno=j+1;
        }  
   
document.querySelector('consolidated-data-analysis').tabwidth=tabwidth;
 document.querySelector('consolidated-data-analysis').studarr=overall;

 document.querySelector('consolidated-report-card').FnSpinnerrActive(false);
 document.querySelector('consolidated-report-card').setDefaultHeaders();

 document.querySelector('consolidated-data-analysis').setDefaultdddHeaders();
       
       
        temp=[];
        overall=[];
      }
    },
    callcategorywisereportfordataanalysisService:function(){
       // document.querySelector('consolidated-data-analysis-report').FnSpinnerrActive(true);
       this.categorywisereportfordataanalysisurl=sessionStorage.getItem("addrinfo")+"/categorywisereportfordataanalysis-service";
        var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
        obj.termname=localStorage.getItem("curr_sess_termname");
        obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
        obj.academicyear=localStorage.getItem("curr_sess_academicyear");
        obj.grade=localStorage.getItem("curr_sess_grade");;
        obj.section=localStorage.getItem("curr_sess_section");
        // obj.assesment=localStorage.getItem("curr_sess_assesment");
        obj.subject=localStorage.getItem("curr_sess_subject");
        this.categorywisereportfordataanalysisparam=obj;
        //alert(JSON.stringify(obj));
        this.$.categorywisereportfordataanalysisajax.generateRequest();
    },
    categorywisereportfordataanalysisResponse:function(e){
     //alert(JSON.stringify(e.detail.response.returnval));
      var overall=[];
      var subarr=[];
      var subfinal=[];
      var catarr=[];
      var catfinal=[];
      var arr1=e.detail.response.returnval;

      for(var x=0;x<studarr.length;x++){
        for(var y=0;y<arr1.length;y++)
        {
          if(studarr[x].id==arr1[y].student_id)
            arr1[y].student_name=studarr[x].student_name;          
        }
      }

      if(arr1.length>0){      
       for(var i=0;i<arr1.length;i++)
       {
        var markarr=[];
        markarr.push(i+1);
        markarr.push(arr1[i].student_name);
        subarr.push(arr1[i].sub_category);
        catarr.push(arr1[i].category);
        markarr.push(arr1[i].total);
        markarr.push(arr1[i].grade);
        for(var j=i+1;j<arr1.length;j++)
        {
           if(arr1[i].student_id==arr1[j].student_id)
           {
            markarr.push(arr1[j].total);
            markarr.push(arr1[j].grade);
            subarr.push(arr1[j].sub_category);
            catarr.push(arr1[j].category);
            arr1.splice(j,1);
            j--;
           }
        }
        overall.push(markarr);
        }      
        // alert(JSON.stringify(subfinal));  
        // alert(JSON.stringify(overall));              
        var subfinal=this.eliminateDuplicates(subarr); 
        var catfinal=this.eliminateDuplicates(catarr); 
        // alert(JSON.stringify(catfinal));
        var titlearr=[]; 
        
        subfinal.splice(0,2); 
        for(var i=0;i<subfinal.length;i++){
          if(subfinal[i]!="Sno"||subfinal[i]!="Student Name"){
            titlearr.push("Total");
            titlearr.push("Grade");
          }
        }   
        // document.querySelector("categorywise-report").categoryarr=catfinal;
        document.querySelector("consolidated-data-analysis-report").setDefaultHeaders1();
        document.querySelector("consolidated-data-analysis-report").FnHideView();
        document.querySelector("consolidated-data-analysis-report").subjectarr=subfinal;
        document.querySelector("consolidated-data-analysis-report").titlearr=titlearr;
        document.querySelector("consolidated-data-analysis-report").itemarr=overall;

        // document.querySelector('consolidated-data-analysis-report').FnSpinnerrActive(false);
 document.querySelector("consolidated-data-analysis-report").tiggerDialog();
document.querySelector('consolidated-data-analysis-report').FnSpinnerrActive(false);
        document.querySelector("consolidated-data-analysis-report").tiggerDialog();

        document.querySelector('consolidated-data-analysis-report').FnSpinnerrActive(false);

        subfinal=[];
        titlearr=[];
        overall=[];        
      }
     }
    
//     callassesmentwisereportService:function(){
//        this.assesmentwisereporturl=sessionStorage.getItem("addrinfo")+"/assesmentwisereport-service";
//         var obj={"schoolid":"","academicyear":"","grade":"","section":"","assesment":"","termname":""};
//         obj.termname=localStorage.getItem("curr_sess_termname");
//         obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
//         obj.academicyear=localStorage.getItem("curr_sess_academicyear");
//         obj.grade=localStorage.getItem("curr_sess_grade");;
//         obj.section=localStorage.getItem("curr_sess_section");
//         obj.assesment=localStorage.getItem("curr_sess_assesment");
//         this.assesmentwisereportparam=obj;
//         this.$.assesmentwisereportajax.generateRequest();
//     },
//     assesmentwisereportResponse:function(e){
//       var overall=[];
//       var subarr=[];
//       var subfinal=[];
//        var arr1=e.detail.response.returnval;
//        // alert(JSON.stringify(arr1));
//        for(var x=0;x<studarr.length;x++){
//         for(var y=0;y<arr1.length;y++)
//         {
//           if(studarr[x].id==arr1[y].student_id)
//             arr1[y].student_name=studarr[x].student_name;          
//         }
//        }
//        if(arr1.length>0){      
//        for(var i=0;i<arr1.length;i++)
//        {
//         var markarr=[];
//         markarr.push((i+1));
//         markarr.push(arr1[i].student_name);
//         subarr.push(arr1[i].subject_id);
//         markarr.push(arr1[i].mark);        
//         markarr.push(arr1[i].grade);
//         for(var j=i+1;j<arr1.length;j++)
//         {
//            if(arr1[i].student_id==arr1[j].student_id)
//            {
//             markarr.push(arr1[i].mark); 
//             markarr.push(arr1[j].grade);
//             subarr.push(arr1[j].subject_id);
//             arr1.splice(j,1);
//             j--;
//            }
//         }
//        overall.push(markarr);
//        }

//         var subfinal=this.eliminateDuplicates(subarr);  
//         var titlearr=[];              
//         // alert(subfinal.length);
//         subfinal.splice(0,2);
//         for(var i=0;i<subfinal.length;i++){
//           if(subfinal[i]!="Sno"||subfinal[i]!="Student Name"){
//             titlearr.push("Total");
//             titlearr.push("Grade");
//           }
//         }
//         document.querySelector("assesmentwise-report-card").subjectarr=subfinal;
//         document.querySelector("assesmentwise-report-card").titlearr=titlearr;
//         document.querySelector("assesmentwise-report-card").itemarr=overall;
//         subjectarr=[];
//         titlearr=[];
//         itemarr=[];
//         }
//     },
//     eliminateDuplicates:function(arr) {
// var i;
//   var len=arr.length;
//   var out=[];
//   var obj={};
//   out.push("Sno");
//   out.push("Student Name");

//  for (i=0;i<len;i++) {
//  obj[arr[i]]=0;
//  }
//  for (i in obj) {
//  out.push(i);
//  }
//  return out;
// },
//  eliminateDuplicates1:function(arr) {
// var i;
//   var len=arr.length;
//   var out=[];
//   var obj={};


//  for (i=0;i<len;i++) {
//  obj[arr[i]]=0;
//  }
//  for (i in obj) {
//  out.push(i);
//  }
//  return out;
// },
//     calltermwisereportService:function(){
//        this.termwisereporturl=sessionStorage.getItem("addrinfo")+"/termwisereport-service";
//         var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
//         obj.termname=localStorage.getItem("curr_sess_termname");
//         obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
//         obj.academicyear=localStorage.getItem("curr_sess_academicyear");
//         obj.grade=localStorage.getItem("curr_sess_grade");;
//         obj.section=localStorage.getItem("curr_sess_section");
//         // obj.assesment=localStorage.getItem("curr_sess_assesment");
//         this.termwisereportparam=obj;
//         this.$.termwisereportajax.generateRequest();
//     },
//     termwisereportResponse:function(e){
//       var overall=[];
//       var assesmentarr=[];
//       var subarr=[];
//       var subcount=1;
//       var asses1=0;
//       var asses2=0;
//       var asses3=0;
//        var arr1=e.detail.response.returnval;
//        // alert(JSON.stringify(arr1));
//        for(var x=0;x<studarr.length;x++){
//         for(var y=0;y<arr1.length;y++)
//         {
//           if(studarr[x].id==arr1[y].student_id)
//             arr1[y].student_name=studarr[x].student_name;          
//         }
//        }
//        if(arr1.length>0){      
//        for(var i=0;i<arr1.length;i++)
//        {
//         var markarr=[];

//         markarr.push(i+1);
//         markarr.push(arr1[i].student_name);
//         assesmentarr.push(arr1[i].assesment_id);
//        // alert(i+''+arr1.length);
//        if(subcount==1)
//        {
//         if(arr1[i].assesment_id=="Assesment1")
//         {
//           asses1++;
//         }
//         if(arr1[i].assesment_id=="Assesment2")
//         {
//           asses2++;
//         }
//         if(arr1[i].assesment_id=="Assesment3")
//         {
//           asses3++;
//         }
//         subarr.push(arr1[i].subject_id);
//       }
       
//         markarr.push(arr1[i].grade);
//         for(var j=i+1;j<arr1.length;j++)
//         {
//            if(arr1[i].student_id==arr1[j].student_id)
//            {
//             markarr.push(arr1[j].grade);
//             assesmentarr.push(arr1[j].assesment_id);
//             if(subcount==1)
//            {
//              if(arr1[j].assesment_id=="Assesment1")
//         {
//           asses1++;
//         }
//         if(arr1[j].assesment_id=="Assesment2")
//         {
//           asses2++;
//         }
//         if(arr1[j].assesment_id=="Assesment3")
//         {
//           asses3++;
//         }
//           subarr.push(arr1[j].subject_id);
//            }
//             arr1.splice(j,1);
//             j--;
//            }
//         }
//         subcount++;

//        // subarr.push(arr1[i].subject_id);
//        overall.push(markarr);
//        }
//        // alert(JSON.stringify(subarr));
//        // alert(JSON.stringify(assesmentarr));
//        var assfinal=this.eliminateDuplicates1(assesmentarr);
//        var subfinal=this.eliminateDuplicates(subarr);
//        var subjectarr=[];
//        subjectarr.push(subfinal[0]);
//        subjectarr.push(subfinal[1]);
//        for(var i=0;i<subarr.length;i++)
//         {
//           subjectarr.push(subarr[i]);
//         }
//        // alert(asses1+''+asses2+''+asses3);
//        //alert(JSON.stringify(subarr));
//        //alert(JSON.stringify(subjectarr));
//         document.querySelector("termwise-report-card").assesmentarr=assfinal;
//         document.querySelector("termwise-report-card").subjectarr=subjectarr;
//         document.querySelector("termwise-report-card").itemarr=overall;
//         document.querySelector("termwise-report-card").assesmentlen(asses1,asses2,asses3);
//         assesmentarr=[];
//         subjectarr=[];
//         itemarr=[];
//       }
//     },

//     callsubjectwisereportService:function(){
//        this.subjectwisereporturl=sessionStorage.getItem("addrinfo")+"/subjectwisereport-service";
//         var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
//         obj.termname=localStorage.getItem("curr_sess_termname");
//         obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
//         obj.academicyear=localStorage.getItem("curr_sess_academicyear");
//         obj.grade=localStorage.getItem("curr_sess_grade");;
//         obj.section=localStorage.getItem("curr_sess_section");
//         obj.assesment=localStorage.getItem("curr_sess_assesment");
//         obj.subject=localStorage.getItem("curr_sess_subject");
//         this.subjectwisereportparam=obj;
//         this.$.subjectwisereportajax.generateRequest();
//     },
//     subjectwisereportResponse:function(e){
//       // alert(JSON.stringify(e.detail.response.returnval));
//       var overall=[];
//       var subarr=[];
//       var subfinal=[];
//       var arr1=e.detail.response.returnval;

//       for(var x=0;x<studarr.length;x++){
//         for(var y=0;y<arr1.length;y++)
//         {
//           if(studarr[x].id==arr1[y].student_id)
//             arr1[y].student_name=studarr[x].student_name;          
//         }
//       }

//       if(arr1.length>0){      
//        for(var i=0;i<arr1.length;i++)
//        {
//         var markarr=[];
//         markarr.push(i+1);
//         markarr.push(arr1[i].student_name);
//         subarr.push(arr1[i].assesment_id);
//         markarr.push(arr1[i].total);
//         markarr.push(arr1[i].grade);
//         for(var j=i+1;j<arr1.length;j++)
//         {
//            if(arr1[i].student_id==arr1[j].student_id)
//            {
//             markarr.push(arr1[j].total);
//             markarr.push(arr1[j].grade);
//             subarr.push(arr1[j].assesment_id);
//             arr1.splice(j,1);
//             j--;
//            }
//         }
//         overall.push(markarr);
//         }      
//         // alert(JSON.stringify(subfinal));  
//         // alert(JSON.stringify(overall));              
//         var subfinal=this.eliminateDuplicates(subarr);      
//         document.querySelector("subjectwise-report-card").subjectarr=subfinal;
//         document.querySelector("subjectwise-report-card").itemarr=overall;
//         subfinal=[];
//         overall=[];
//       }
//     },
//     callcategorywisereportService:function(){
//        this.categorywisereporturl=sessionStorage.getItem("addrinfo")+"/categorywisereport-service";
//         var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
//         obj.termname=localStorage.getItem("curr_sess_termname");
//         obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
//         obj.academicyear=localStorage.getItem("curr_sess_academicyear");
//         obj.grade=localStorage.getItem("curr_sess_grade");;
//         obj.section=localStorage.getItem("curr_sess_section");
//         obj.assesment=localStorage.getItem("curr_sess_assesment");
//         // alert(JSON.stringify(localStorage.getItem("curr_sess_assesment")));
//         obj.subject=localStorage.getItem("curr_sess_subject");
//         this.categorywisereportparam=obj;
//         this.$.categorywisereportajax.generateRequest();
//     },
//     categorywisereportResponse:function(e){
//       // alert(JSON.stringify(e.detail.response.returnval));
//       var overall=[];
//       var subarr=[];
//       var subfinal=[];
//       var catarr=[];
//       var catfinal=[];
//       var arr1=e.detail.response.returnval;
//       var sarr=e.detail.response.catarr;
//       // alert(JSON.stringify(sarr));
//       for(var x=0;x<studarr.length;x++){
//         for(var y=0;y<arr1.length;y++)
//         {
//           if(studarr[x].id==arr1[y].student_id)
//             arr1[y].student_name=studarr[x].student_name;          
//         }
//       }
//       if(arr1.length>0){      
//        // var f=0;
//        for(var i=0;i<arr1.length;i++)
//        {
//         // f=1;
//         var markarr=[];
//         markarr.push(i+1);
//         markarr.push(arr1[i].student_name);
//         subarr.push(arr1[i].sub_category);
//         catarr.push(arr1[i].category);
//         markarr.push(arr1[i].total);
//         markarr.push(arr1[i].grade);
//         for(var j=i+1;j<arr1.length;j++)
//         {
//            if(arr1[i].student_id==arr1[j].student_id)
//            {
//             markarr.push(arr1[j].total);
//             markarr.push(arr1[j].grade);
//             // if(i==0)
//             subarr.push(arr1[j].sub_category);
//             catarr.push(arr1[j].category);
//             arr1.splice(j,1);
//             j--;
//            }
//         }
//         overall.push(markarr);
//         }      
//         // alert(JSON.stringify(subfinal));  
//         // alert(JSON.stringify(overall));              
//         // var subfinal=this.eliminateDuplicates(subarr); 
//         var catfinal=this.eliminateDuplicates(catarr); 
//         // alert(JSON.stringify(sarr.length));
//         var titlearr=[];
//         subfinal.push("Sno");
//         subfinal.push("Student Name");
//         for(var i=0;i<sarr.length;i++){
//           subfinal.push(sarr[i].sub_category_name);
//         } 
//         // subfinal=sarr;
//         subfinal.splice(0,2); 
//         for(var i=0;i<subfinal.length;i++){
//           if(subfinal[i]!="Sno"||subfinal[i]!="Student Name"){
//             titlearr.push("Total");
//             titlearr.push("Grade");
//           }
//         }
//         // alert(JSON.stringify(subfinal));   
//         // alert(JSON.stringify(titlearr));
//         // alert(JSON.stringify(overall));
//         // document.querySelector("categorywise-report").categoryarr=catfinal;
//         document.querySelector("categorywise-report").FnHideView();
//         document.querySelector("categorywise-report").subjectarr=subfinal;
//         document.querySelector("categorywise-report").titlearr=titlearr;
//         document.querySelector("categorywise-report").itemarr=overall;
//         subfinal=[];
//         titlearr=[];
//         overall=[];
        
//       }
//     },
//     callconsolidatedtermwisereportService:function(){
//         this.fetchconsolidatedtermwiseurl=sessionStorage.getItem("addrinfo")+"/fetchconsolidatedtermwise-service";
//         var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
//         obj.termname=localStorage.getItem("curr_sess_termname");
//         obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
//         obj.academicyear=localStorage.getItem("curr_sess_academicyear");
//         obj.grade=localStorage.getItem("curr_sess_grade");;
//         obj.section=localStorage.getItem("curr_sess_section");
//         this.fetchconsolidatedtermwiseparam=obj;
//         this.$.fetchconsolidatedtermwiseajax.generateRequest();
//     },
//     fetchconsolidatedtermwiseResponse:function(e){
//       var overall=[];
//       var assesmentarr=[];
//       var subarr=[];
//       var titlearr=[];

//        var arr1=e.detail.response.returnval;
//        // alert(JSON.stringify(arr1));
//        for(var x=0;x<studarr.length;x++){
//         for(var y=0;y<arr1.length;y++)
//         {
//           if(studarr[x].id==arr1[y].student_id)
//             arr1[y].student_name=studarr[x].student_name;          
//         }
//        }
//        if(arr1.length>0){      
//        for(var i=0;i<arr1.length;i++)
//        {
//         var markarr=[];

//         markarr.push(i+1);
//         markarr.push(arr1[i].student_name);
//         markarr.push(arr1[i].total);
//         markarr.push(arr1[i].grade);
//         subarr.push(arr1[i].subject_id);
//         for(var j=i+1;j<arr1.length;j++)
//         {
//            if(arr1[i].student_id==arr1[j].student_id)
//            {
//             markarr.push(arr1[j].total);
//             markarr.push(arr1[j].grade); 
//             subarr.push(arr1[j].subject_id);           
//             arr1.splice(j,1);
//             j--;
//            }
//         }
//        overall.push(markarr);
//        }
//        var subfinal=this.eliminateDuplicates(subarr);
//        subfinal.splice(0,2); 
//         for(var i=0;i<subfinal.length;i++){
//           if(subfinal[i]!="Sno"||subfinal[i]!="Student Name"){
//             titlearr.push("Total");
//             titlearr.push("Grade");
//           }
//         }    
//        // alert(JSON.stringify(subfinal));
//        // alert(JSON.stringify(overall));
//         document.querySelector("consolidatedtermwise-report-card").subjectarr=subfinal;
//         document.querySelector("consolidatedtermwise-report-card").titlearr=titlearr;
//         document.querySelector("consolidatedtermwise-report-card").itemarr=overall;
//         subfinal=[];
//         overall=[];
//         titlearr=[];
//       }
//     },
//     callconsolidateddatanalysisreportService:function(){

//       this.consolidateddatanalysisreporturl=sessionStorage.getItem("addrinfo")+"/consolidateddatanalysisreport-service";
//         var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
//         obj.termname=localStorage.getItem("curr_sess_termname");
//         obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
//         obj.academicyear=localStorage.getItem("curr_sess_academicyear");
//         obj.grade=localStorage.getItem("curr_sess_grade");;
//         obj.section=localStorage.getItem("curr_sess_section");
//         this.consolidateddatanalysisreportparam=obj;
//         this.$.consolidateddatanalysisreportajax.generateRequest();
//     },
//     consolidateddatanalysisreportResponse:function(e){
//       var overall=[];
//       var assesmentarr=[];
//       var subarr=[];
//       var titlearr=[];
//       var arr1=e.detail.response.returnval;
//        for(var x=0;x<studarr.length;x++){
//         for(var y=0;y<arr1.length;y++)
//         {
//           if(studarr[x].id==arr1[y].student_id)
//             arr1[y].student_name=studarr[x].student_name;          
//         }
//        }
//        // alert(JSON.stringify(arr1));
//        if(arr1.length>0){      
//        for(var i=0;i<arr1.length;i++)
//        {
//         var markarr=[];
//         var obj={};
//         var t1=[];
//         markarr.push({"sno":i+1});
//         markarr.push({"studentname":arr1[i].student_name});
//         // obj.sno=i+1;
//         // obj.studentname=arr1[i].student_name;
//         obj.studentid=arr1[i].student_id;
//         obj.subject=arr1[i].subject_id;
//         obj.term=localStorage.getItem("curr_sess_termname");
//         obj.grade=localStorage.getItem("curr_sess_grade");
//         obj.section=localStorage.getItem("curr_sess_section");
//         obj.mark=(arr1[i].total);
//         // markarr.push(arr1[i].grade);
//         t1.push(obj);
//         // markarr.push(obj);
//         subarr.push(arr1[i].subject_id);
//         for(var j=i+1;j<arr1.length;j++)
//         {
//            if(arr1[i].student_id==arr1[j].student_id)
//            {
//             var obj1={};
//             // obj1.sno=i+1;
//             // obj1.studentname=arr1[i].student_name;
//             obj1.studentid=arr1[j].student_id;
//             obj1.subject=arr1[j].subject_id;
//             obj1.mark=(arr1[j].total);
//             obj1.term=localStorage.getItem("curr_sess_termname");
//             obj1.grade=localStorage.getItem("curr_sess_grade");
//             obj1.section=localStorage.getItem("curr_sess_section");
//             t1.push(obj1);
//             // markarr.push(arr1[j].total);
//             // markarr.push(arr1[j].grade); 
//             subarr.push(arr1[j].subject_id);           
//             arr1.splice(j,1);
//             j--;
//            }
//         }
//         markarr.push({"mark":t1});
//         overall.push(markarr);
//        }
//        var subfinal=this.eliminateDuplicates(subarr);
//        subfinal.splice(0,2); 
//         for(var i=0;i<subfinal.length;i++){
//           if(subfinal[i]!="Sno"||subfinal[i]!="Student Name"){
//             titlearr.push("Total");
//             // titlearr.push("Grade");
//           }
//         }    
//        // alert(JSON.stringify(subfinal));
//         // alert(JSON.stringify(overall));
//         document.querySelector("consolidated-data-analysis-report").subjectarrr=subfinal;
//         // document.querySelector("consolidated-data-analysis-report").titlearr=titlearr;
//         document.querySelector("consolidated-data-analysis-report").itemarrr=overall;
//         subfinal=[];
//         overall=[];
//         titlearr=[];
//       }
//     },
//     callcategorywisereportfordataanalysisService:function(){
//        // document.querySelector('consolidated-data-analysis-report').FnSpinnerrActive(true);
//        this.categorywisereportfordataanalysisurl=sessionStorage.getItem("addrinfo")+"/categorywisereportfordataanalysis-service";
//         var obj={"schoolid":"","academicyear":"","grade":"","section":"","termname":""};
//         obj.termname=localStorage.getItem("curr_sess_termname");
//         obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
//         obj.academicyear=localStorage.getItem("curr_sess_academicyear");
//         obj.grade=localStorage.getItem("curr_sess_grade");;
//         obj.section=localStorage.getItem("curr_sess_section");
//         // obj.assesment=localStorage.getItem("curr_sess_assesment");
//         obj.subject=localStorage.getItem("curr_sess_subject");
//         this.categorywisereportfordataanalysisparam=obj;
//         this.$.categorywisereportfordataanalysisajax.generateRequest();
//     },
//     categorywisereportfordataanalysisResponse:function(e){
//       // alert(JSON.stringify(e.detail.response.returnval));
//       var overall=[];
//       var subarr=[];
//       var subfinal=[];
//       var catarr=[];
//       var catfinal=[];
//       var arr1=e.detail.response.returnval;

//       for(var x=0;x<studarr.length;x++){
//         for(var y=0;y<arr1.length;y++)
//         {
//           if(studarr[x].id==arr1[y].student_id)
//             arr1[y].student_name=studarr[x].student_name;          
//         }
//       }

//       if(arr1.length>0){      
//        for(var i=0;i<arr1.length;i++)
//        {
//         var markarr=[];
//         markarr.push(i+1);
//         markarr.push(arr1[i].student_name);
//         subarr.push(arr1[i].sub_category);
//         catarr.push(arr1[i].category);
//         markarr.push(arr1[i].total);
//         markarr.push(arr1[i].grade);
//         for(var j=i+1;j<arr1.length;j++)
//         {
//            if(arr1[i].student_id==arr1[j].student_id)
//            {
//             markarr.push(arr1[j].total);
//             markarr.push(arr1[j].grade);
//             subarr.push(arr1[j].sub_category);
//             catarr.push(arr1[j].category);
//             arr1.splice(j,1);
//             j--;
//            }
//         }
//         overall.push(markarr);
//         }      
//         // alert(JSON.stringify(subfinal));  
//         // alert(JSON.stringify(overall));              
//         var subfinal=this.eliminateDuplicates(subarr); 
//         var catfinal=this.eliminateDuplicates(catarr); 
//         // alert(JSON.stringify(catfinal));
//         var titlearr=[]; 
        
//         subfinal.splice(0,2); 
//         for(var i=0;i<subfinal.length;i++){
//           if(subfinal[i]!="Sno"||subfinal[i]!="Student Name"){
//             titlearr.push("Total");
//             titlearr.push("Grade");
//           }
//         }   
//         // document.querySelector("categorywise-report").categoryarr=catfinal;
//         document.querySelector("consolidated-data-analysis-report").setDefaultHeaders1();
//         document.querySelector("consolidated-data-analysis-report").FnHideView();
//         document.querySelector("consolidated-data-analysis-report").subjectarr=subfinal;
//         document.querySelector("consolidated-data-analysis-report").titlearr=titlearr;
//         document.querySelector("consolidated-data-analysis-report").itemarr=overall;
//         // document.querySelector('consolidated-data-analysis-report').FnSpinnerrActive(false);
//         document.querySelector("consolidated-data-analysis-report").tiggerDialog();
//         subfinal=[];
//         titlearr=[];
//         overall=[];        
//       }
//     }
    });
  })();
  </script>
</dom-module>
